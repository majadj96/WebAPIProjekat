<!DOCTYPE html>
<html>
<head>
    <title>Falmingo taxi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="Scripts/jquery-1.10.2.js"></script>

    <style>
        body {
            font: 20px Montserrat, sans-serif;
            line-height: 1.8;
            color: black;
        }

        p {
            font-size: 16px;
        }

        .margin {
            margin-bottom: 45px;
        }

        .bg-1 {
            background-color: #1abc9c; /* Green */
            color: #ffffff;
        }

        .bg-2 {
            background-color: #474e5d; /* Dark Blue */
            color: #ffffff;
        }

        .bg-3 {
            background-color: #ffffff; /* White */
            color: #555555;
        }

        .bg-4 {
            background-color: #2f2f2f; /* Black Gray */
            color: #fff;
        }

        .container-fluid {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        .navbar {
            padding-top: 15px;
            padding-bottom: 15px;
            border: 0;
            border-radius: 0;
            margin-bottom: 0;
            font-size: 12px;
            letter-spacing: 5px;
        }

        .navbar-nav li a:hover {
            color: #1abc9c !important;
            font-size: 150%;
        }

        #korisnikProfil {
            color: #1abc9c;
        }

        #korisnikProfil:hover {
             background-color: #1abc9c;
             color: white;
             font-weight:bold;
             font-size:x-large;
        }

        th, td {
            padding: 4px;
            text-align: left;
        }


    </style>

    <script type="text/javascript">

        function getEnumStatus(id) {
            switch (id) {
                case 0: return "Kreirana";
                case 1: return "Formirana";
                case 2: return "Obradjena";
                case 3: return "Prihvacena";
                case 4: return "Otkazana";
                case 5: return "Neuspesna";
                case 6: return "Uspesna";
            }
        }

        function getEnumTipAutomobila(id) {
            switch (id) {
                case 0: return "Putnicki";
                case 1: return "Kombi";
            }
        }
            function getEnumPol(id) {
                switch (id) {
                    case 0: return "Zenski";
                    case 1: return "Muski";
                }
        }
        
        $(document).ready(function () {
            $("#profil").hide();
            $("#korisnik").css("display", "none");
            $("#dispecer").css("display", "none");
            $("#vozac").css("display", "none");
            $("#dugmeIzmeni").hide();
            $('#dodajVozaca').hide();
            $('#promeniLokaciju').hide();
            $('#naruciVoznju').hide();
            $('#dodavanjeKorisnikaDiv').hide();
            $("#dugmeDodajVozaca").hide();
            $("#dugmePromeniLokacijuDiv").hide();
            $("#promeniLokacijuDiv").hide();
            $("#naruciVoznjuDiv").hide();
            $("#dugmeNaruciVoznjuDiv").hide();
            
            var uloga = '';

            
            
            //poslacu ajax poziv da mi ucita listu voznju i da mi vrati :)
         /*
          *
          *   let imehehe = localStorage.getItem("korisnik");
                        $.get("/api/Voznja/" + imehehe, function (data, status) {
                            let tabelaVoznji = "<table border='1'>";
                            for (voznja in data) {
                                tabelaVoznji += `<tr><td>${data[voznja].DatumVreme}</td><td>${data[voznja].idKorisnik}</td></tr>`;
                            }
                            tabelaVoznji += "</table>";
                            $("#korisnik").html(tabelaVoznji);
                        });
          * 
          * */


            let korisnik1 = "";

            var ime = localStorage.getItem("korisnik");
            $("#wel").text(ime);

            let korisnik = {
                KorisnickoIme: `${ime}`,
            };

            $.ajax({
                type: 'POST',
                url: '/api/Pocetna/',
                data: JSON.stringify(korisnik),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    korisnik1 = data;
                   uloga = data.Uloga; // 0 korisnik , 1 dispecer , 2 vozac
                    if (data.Uloga == 0) {
                        alert("Musterija logovana");
                        $("#korisnik").css("display", "block");
                        //    $("#korisnik").css("float", "right");
                        $("#korisnik").css("clear", "both");
                        $("#korisnik").css("position", "sticky");

                        $('#naruciVoznju').show();

                        var id = localStorage.getItem("korisnik")+";k";
                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja/',
                            //     contentType: 'application/json; charset=utf-8',
                            data: {
                                "id": id
                            },
                            //   dataType: 'json',
                            success: function (data) {

                                let tabelaVoznji = "<table border='1'><tr><td>Id voznje</td><td>Datum i vreme</td><td>Tip automobila</td><td>Status voznje</td><td colspan=\"2\"></td></tr>";
                                for (voznja in data) {
                                    tabelaVoznji += `<tr>
                                                    <td>${data[voznja].Id}</td>
                                                    <td>${data[voznja].DatumVreme}</td>
                                                    <td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                    <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                    `;
                                    if (data[voznja].StatusVoznje == 0) {


                                        tabelaVoznji += `
                                                    <td><button id="otkaziVoznju" value="${data[voznja].Id}">Otkazi</button></td>
                                                    <td><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                        </tr>`;
                                    } else {
                                        tabelaVoznji += `
                                                    <td colspan=\"2\"></td>
                                                        </tr>`;
                                    }
                                }
                                tabelaVoznji += "</table>";
                                $("#tabelaVoznji").html(tabelaVoznji);
                            }
                        })

                    } else if (data.Uloga == 1) {
                        alert("Dispecer logovan");
                        $("#dispecer").css("display", "inline");
                        $('#dodajVozaca').show();


                    }
                    else if (data.Uloga == 2) {
                        alert("Vozac logovana");
                        $("#vozac").css("display", "inline");
                        $('#promeniLokaciju').show();


                    }
                }

            })

            //LINK U MENIJU PROFIL
            $("#korisnikProfil").click(function () {

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                $("#korisnik").css("display", "none");
                $("#dispecer").css("display", "none");
                $("#vozac").css("display", "none");

                $("#naruciVoznjuDiv").hide();
                $("#dugmeNaruciVoznjuDiv").hide();

                $("#dugmePromeniLokacijuDiv").hide();
                $("#dugmeDodajVozaca").hide();
                $('#dodavanjeKorisnikaDiv').hide();
                $("#promeniLokacijuDiv").hide();
                $("#pocetna").hide();
                $("#pocetna1").hide();
                $('#profil').show(500);
                let informacije = "<br /><table id=\"tabelaObicna\" border='1'>";
                    informacije += `
                                <tr>
                                    <td>JMBG:</td>
                                    <td>${korisnik1.JMBG}</td>
                                </tr>
                                <tr>
                                    <td>Pol:</td>
                                    <td>${getEnumPol(korisnik1.Pol)}</td>
                                </tr>
                                <tr>
                                    <td>Korisnicko ime:</td>
                                    <td>${korisnik1.KorisnickoIme}</td>
                                </tr>
                                <tr>
                                    <td>Lozinka:</td>
                                    <td>${korisnik1.Lozinka}</td>
                                </tr>
                                <tr>
                                    <td>Ime:</td>
                                    <td>${korisnik1.Ime}</td>
                                </tr>
                                <tr>
                                    <td>Prezime:</td>
                                    <td>${korisnik1.Prezime}</td>
                                </tr>
                                 <tr>
                                    <td>Telefon:</td>
                                    <td>${korisnik1.KontaktTelefon}</td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td>${korisnik1.Email}</td>
                                </tr>
               
                               
                                    `;
                informacije += "</table>";
                $('#profil').html(informacije);
                $('#dugmeIzmeni').show(500);
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }

            });

            //LINK POCETNA STRANICA
            $("#pocetnaStranica").click(function () {

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                  

                    if (uloga == 0) {
                        $("#korisnik").css("display", "block");
                        //    $("#korisnik").css("float", "right");
                        $("#korisnik").css("clear", "both");
                        $("#korisnik").css("position", "sticky");
                    } else if (uloga == 1) {
                        $("#dispecer").css("display", "block");

                        //dispecer tabele
                    } else if (uloga == 2) {
                        $("#vozac").css("display", "block");
                    }

                $("#naruciVoznjuDiv").hide();
                $("#dugmeNaruciVoznjuDiv").hide();
              //  $("#dugmeADDVozaca").hide();
                $('#dodavanjeKorisnikaDiv').hide();
                $("#dugmeDodajVozaca").hide();
                $("#profil").hide();
                $("#pocetna1").show();
                $("#pocetna").show();
                $('#dugmeIzmeni').hide();

                $("#promeniLokacijuDiv").hide();
                $("#dugmePromeniLokacijuDiv").hide();
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }



            });

            //DUGME PROMENI INFORMACJE _ SACUVAJ
            $("#izmeni").click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    $("#izmeni").text("Sacuvaj");
                    $("#dugmeDodajVozaca").hide();
                    $('#subBut').hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#naruciVoznjuDiv").hide();
                    $("#dugmeNaruciVoznjuDiv").hide();


                    $("#tabelaObicna").hide(500);
                    let informacije = "<br /><table id=\"tabelaNeobicna\" border='1'>";
                    informacije += ` <tr>
                                    <td>JMBG:</td>
                                    <td>${korisnik1.JMBG}</td>
                                </tr>
                                <tr>
                                    <td>Pol:</td>
                                    <td>${getEnumPol(korisnik1.Pol)}</td>
                                </tr><tr>
                                    <td>Korisnicko ime:</td>
                                    <td><input type=\"text\" id=\"korisnickoImeIzmeni\" value=\"${korisnik1.KorisnickoIme}\" /></td>
                                </tr>
                                <tr>
                                    <td>Lozinka:</td>
                                    <td><input type=\"text\" id=\"lozinkaIzmeni\" value=\"${korisnik1.Lozinka}\" /></td>
                                </tr>
                                <tr>
                                    <td>Ime:</td>
                                    <td><input type=\"text\" id=\"imeIzmeni\" value=\"${korisnik1.Ime}\" /></td>
                                </tr>
                                <tr>
                                    <td>Prezime:</td>
                                    <td><input type=\"text\" id=\"prezimeIzmeni\" value=\"${korisnik1.Prezime}\" /></td>
                                </tr>
                                 <tr>
                                    <td>Telefon:</td>
                                    <td><input type=\"text\" id=\"telefonIzmeni\" value=\"${korisnik1.KontaktTelefon}\" /></td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td><input type=\"text\" id=\"emailIzmeni\" value=\"${korisnik1.Email}\" /></td>
                                </tr>
                                `;
                    informacije += "</table>";
                    $('#profil').html(informacije);
                } else {
            //ako je udjeno u to
                    $("#izmeni").css("background-color", '');

                    let korisnik = {
                        KorisnickoIme: `${korisnik1.KorisnickoIme};`+`${$('#korisnickoImeIzmeni').val()}`,
                        Lozinka: `${$('#lozinkaIzmeni').val()}`,
                        Ime: `${$('#imeIzmeni').val()}`,
                        Prezime: `${$('#prezimeIzmeni').val()}`,
                        Email: `${$('#emailIzmeni').val()}`,
                        KontaktTelefon: `${$('#telefonIzmeni').val()}`,
                    };



                    let idd = korisnik.KorisnickoIme;
                    alert(idd);


                    $.ajax({
                        type: 'PUT',
                        url: '/api/Izmeni/'+idd,
                        data: JSON.stringify(korisnik),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {

                            if (data.KorisnickoIme == "postoji") {
                                alert("Zauzeto korisnicko ime!");

                            } else {
                                $("#izmeni").text("Promeni informacije");

                                korisnik1 = data;
                                localStorage.setItem("korisnik", korisnik1.KorisnickoIme);
                                var ime = localStorage.getItem("korisnik");
                                $("#wel").text(ime);
                                $("#tabelaNeobicna").hide(500);
                                let informacije = "<br /><table id=\"tabelaObicna\" border='1'>";
                                informacije += ` <tr>
                                    <td>JMBG:</td>
                                    <td>${korisnik1.JMBG}</td>
                                </tr>
                                <tr>
                                    <td>Pol:</td>
                                    <td>${getEnumPol(korisnik1.Pol)}</td>
                                </tr><tr>
                                    <td>Korisnicko ime:</td>
                                    <td>${korisnik1.KorisnickoIme}</td>
                                </tr>
                                <tr>
                                    <td>Lozinka:</td>
                                    <td>${korisnik1.Lozinka}</td>
                                </tr>
                                <tr>
                                    <td>Ime:</td>
                                    <td>${korisnik1.Ime}</td>
                                </tr>
                                <tr>
                                    <td>Prezime:</td>
                                    <td>${korisnik1.Prezime}</td>
                                </tr>
                                 <tr>
                                    <td>Telefon:</td>
                                    <td>${korisnik1.KontaktTelefon}</td>
                                </tr>
                                <tr>
                                    <td>Email:</td>
                                    <td>${korisnik1.Email}</td>
                                </tr>
               
                               
                                    `;
                                informacije += "</table>";
                                $('#profil').html(informacije);
                            }
                        }
                    })






                }


            });


            //IZGLED ZA DODAVANJE VOZACA  , link u meniju
            $('#dodajVozaca').click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#dugmeDodajVozaca").show();
                    $("#subBut").show();
                    $("#profil").hide();
                    $("#pocetna1").hide();
                    $("#pocetna").hide();
                    $('#dugmeIzmeni').hide();
                    $("#promeniLokacijuDiv").hide();
                    $('#dodavanjeKorisnikaDiv').show();
                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();


                    let informacije = "<table id=\"tabelaVozaca\" border='1'>";
                    informacije += `<tr>
                                    <td>Ime:</td>
                                    <td><input type=\"text\" id=\"imeVozac\"/></td>
                                </tr>
                                <tr>
                                    <td>Prezime:</td>
                                    <td><input type=\"text\" id=\"prezimeVozac\"/></td>
                                </tr>
                                <tr>
                                    <td>Korisnicko ime:</td>
                                    <td><input type=\"text\" id=\"korisnickoImeVozac\"/></td>
                                </tr>
                                <tr>
                                    <td>Lozinka:</td>
                                    <td><input type=\"text\" id=\"lozinkaVozac\"/></td>
                                </tr>
                                 <tr>
                                    <td>JMBG:</td>
                                    <td><input type=\"text\" id=\"jmbgVozac\"/></td>
                                </tr>
                                <tr>
                                    <td>Telefon:</td>
                                    <td><input type=\"text\" id=\"telefonVozac\"/></td>
                                </tr>
                                <tr>
                                    <td>Emal:</td>
                                    <td><input type=\"text\" id=\"emailVozac\"/></td>
                                </tr>
                               
                                <tr>
                                <td>Pol: </td>
                                <td>
                                    <select name="Pol" id="polVozac">
                                        <option>
                                            Zenski
                                        </option>
                                        <option>
                                            Muski
                                        </option>
                                    </select>
                                </td>
                            </tr>

                            <tr>        
                                <td>X koorginata</td>
                                    <td><input type=\"text\" id=\"xVozac\"/></td>
                            </tr>

                             <tr>        
                                <td>Y koorginata</td>
                                    <td><input type=\"text\" id=\"yVozac\"/></td>
                            </tr>

                             <tr>        
                                <td>Ulica i broj</td>
                                    <td><input type=\"text\" id=\"ulicaibrojVozac\"/></td>
                            </tr>

                            <tr>        
                                <td>Mesto</td>
                                    <td><input type=\"text\" id=\"mestoVozac\"/></td>
                            </tr>

                            <tr>        
                                <td>Postanski broj</td>
                                    <td><input type=\"text\" id=\"postanskiBrojVozac\"/></td>
                            </tr>

                            <tr>        
                                <td>Godiste auta</td>
                                    <td><input type=\"text\" id=\"godisteAutaVozac\"/></td>
                            </tr>

                            <tr>        
                                <td>Registracija auta</td>
                                    <td><input type=\"text\" id=\"registracijaAutaVozac\"/></td>
                            </tr>

                             <tr>
                                <td>Tip auta: </td>
                                <td>
                                    <select name="Tip" id="tipAuta">
                                        <option>
                                            Putnicki
                                        </option>
                                        <option>
                                            Kombi
                                        </option>
                                    </select>
                                </td>
                            </tr>
                                    `;

                    informacije += "</table>";
                    $('#dodavanjeKorisnikaDiv').html(informacije);

                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");
                }

            });

            //LOGOUT
            $('#odlogovanje').click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    localStorage.setItem("korisnik", "");
                    $(location).attr('href', 'index.html')
                  } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color","#ff4d4d");

                }
               


            });
            //DODAVANJE VOZAZCA, sta se radi kada se klikne na dugme
            $('#subBut').click(function () {
                alert("Saljem vozaca");

                let vozac = {
                    KorisnickoIme: `${$('#korisnickoImeVozac').val()}`,
                    Lozinka: `${$('#lozinkaVozac').val()}`,
                    Ime: `${$('#imeVozac').val()}`,
                    Prezime: `${$('#prezimeVozac').val()}`,
                    Email: `${$('#emailVozac').val()}`,
                    KontaktTelefon: `${$('#telefonVozac').val()}`,
                    Pol: `${$('#polVozac').val()}`,
                    JMBG: `${$('#jmbgVozac').val()}`,
                    Lokacija: `${""}`,
                    Automobil: `${""}`,
                };

                let lokacija = {
                    X: `${$('#xVozac').val()}`,
                    Y: `${$('#yVozac').val()}`,
                    Adresa: `${""}`,
                };

                let adresa = {
                    UlicaBroj: `${$('#ulicaibrojVozac').val()}`,
                    NaseljenoMesto: `${$('#mestoVozac').val()}`,
                    PozivniBrojMesta: `${$('#postanskiBrojVozac').val()}`,
                };

                lokacija.Adresa = adresa;

                let automobil = {
                    Godiste: `${$('#godisteAutaVozac').val()}`,
                    Registracija: `${$('#registracijaAutaVozac').val()}`,
                    Tip: `${$('#tipAuta').val()}`,
                };

                vozac.Lokacija = lokacija;
                vozac.Automobil = automobil;



                $.ajax({
                    type: 'POST',
                    url: '/api/Vozac',
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data)
                            alert("Korisnicko ime zauzeto.")
                        else {
                            alert("Vozac dodat!")
                            $("#pocetna1").show();
                            $("#pocetna").show();
                            $("#dugmeDodajVozaca").hide();
                            $("#dodavanjeKorisnikaDiv").hide();
                            $("#promeniLokacijuDiv").hide();
                            $("#dugmePromeniLokacijuDiv").hide();


                        }
                    }
                })

            });


            //LINK U MENIJU - PROMENI LOKACIJU - VOZAC ima to
            $('#promeniLokaciju').click(function () {
                $("#pocetna1").hide();
                $("#profil").hide();
                $("#pocetna").hide();
                $("#dugmeDodajVozaca").hide();
                $("#dodavanjeKorisnikaDiv").hide();
                $("#dugmeIzmeni").hide();
                $("#promeniLokacijuDiv").show();
                $("#dugmePromeniLokacijuDiv").show();

                let informacije = "<br /><table border='1'>";
                informacije += `  <tr>        
                                <td>X koorginata</td>
                                    <td><input type=\"text\" id=\"xPromeni\"/></td>
                            </tr>

                             <tr>        
                                <td>Y koorginata</td>
                                    <td><input type=\"text\" id=\"yPromeni\"/></td>
                            </tr>

                             <tr>        
                                <td>Ulica i broj</td>
                                    <td><input type=\"text\" id=\"ulicaibrojPromeni\"/></td>
                            </tr>

                            <tr>        
                                <td>Mesto</td>
                                    <td><input type=\"text\" id=\"mestoPromeni\"/></td>
                            </tr>

                            <tr>        
                                <td>Postanski broj</td>
                                    <td><input type=\"text\" id=\"postanskiBrojPromeni\"/></td>
                            </tr>
                                `;
                informacije += "</table>";
                $('#promeniLokacijuDiv').html(informacije);

            });

            //DUGME U DA SE PROMENI LOKACIJA U VOZACU 
            $("#promeniLokacijuBut").click(function () {
                
                let ime = localStorage.getItem("korisnik");
                let vozac = {
                    KorisnickoIme: ime,
                    Lozinka: `${""}`,
                    Ime: `${""}`,
                    Prezime: `${""}`,
                    Email: `${""}`,
                    KontaktTelefon: `${""}`,
                    Pol: `${""}`,
                    JMBG: `${""}`,
                    Lokacija: `${""}`,
                    Automobil: `${""}`,
                };



                let lokacija = {
                    X: `${$('#xPromeni').val()}`,
                    Y: `${$('#yPromeni').val()}`,
                    Adresa: `${""}`,
                };

                let adresa = {
                    UlicaBroj: `${$('#ulicaibrojPromeni').val()}`,
                    NaseljenoMesto: `${$('#mestoPromeni').val()}`,
                    PozivniBrojMesta: `${$('#postanskiBrojPromeni').val()}`,
                };

                lokacija.Adresa = adresa; //NOVA LOKACIJA

                vozac.Lokacija = lokacija;

                //AJAXOM CELOG VOZACA I VRATI GA A 

                $.ajax({
                    type: 'POST',
                    url: '/api/Lokacija',
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            let tabelaVoznji = "<table border='1'><tr><td>Id voznje</td><td>Datum i vreme</td><td>Tip automobila</td><td>Status voznje</td><td colspan=\"2\"></td></tr>";
                            for (voznja in data) {
                                tabelaVoznji += `<tr>
                                                    <td>${data[voznja].Id}</td>
                                                    <td>${data[voznja].DatumVreme}</td>
                                                    <td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                    <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                    `;
                                if (data[voznja].StatusVoznje == 0) {


                                    tabelaVoznji += `
                                                    <td><button id="otkaziVoznju" value="${data[voznja].Id}">Otkazi</button></td>
                                                    <td><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                        </tr>`;
                                } else {
                                    tabelaVoznji += `
                                                    <td colspan=\"2\"></td>
                                                        </tr>`;
                                }
                            }
                            tabelaVoznji += "</table>";
                            $("#tabelaVoznji").html(tabelaVoznji);
                        }
                            }
                })

            });


            //LINK U MENIJU NARUCI VOZNJU _ DISPECER to ima
            $('#naruciVoznju').click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#korisnik").css("display", "none");

                    $("#pocetna1").hide();
                    $("#profil").hide();
                    $("#pocetna").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#dodavanjeKorisnikaDiv").hide();
                    $("#dugmeIzmeni").hide();
                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#naruciVoznjuDiv").show();//tu dodajem tabelu
                    $("#dugmeNaruciVoznjuDiv").show();


                    let informacije = "<br /><table border='1'>";
                    // Tabela ima objekat voznja + tip auta da se izabere
                    informacije += `  <tr>        
                                <td>X koorginata</td>
                                    <td><input type=\"text\" id=\"xVoznja\"/></td>
                            </tr>

                             <tr>        
                                <td>Y koorginata</td>
                                    <td><input type=\"text\" id=\"yVoznja\"/></td>
                            </tr>

                             <tr>        
                                <td>Ulica i broj</td>
                                    <td><input type=\"text\" id=\"ulicaibrojVoznja\"/></td>
                            </tr>

                            <tr>        
                                <td>Mesto</td>
                                    <td><input type=\"text\" id=\"mestoVoznja\"/></td>
                            </tr>

                            <tr>        
                                <td>Postanski broj</td>
                                    <td><input type=\"text\" id=\"postanskiBrojVoznja\"/></td>
                            </tr>
                             <tr>        
                                <td>Tip automobila:</td>
                                    <td>
                                    <select name="Tip" id="automobilVoznja">
                                        <option>
                                            Putnicki
                                        </option>
                                        <option>
                                            Kombi
                                        </option>
                                    </select>
                                </td>
                            </tr>

                                `;
                    informacije += "</table>";
                    $('#naruciVoznjuDiv').html(informacije);
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color","#ff4d4d");
               
                }
            });

            //KADA SE KLIKNE NA DUGME NARUCI VOZNJU 
            $("#naruciVoznjuBut").click(function () {
                let ime = localStorage.getItem("korisnik");
                let voznja = {
                    Lokacija: `${""}`,
                    Automobil: `${$('#automobilVoznja').val()}`,
                    idKorisnik: ime,
                };


                let lokacija = {
                    X: `${$('#xVoznja').val()}`,
                    Y: `${$('#yVoznja').val()}`,
                    Adresa: `${""}`,
                };

                let adresa = {
                    UlicaBroj: `${$('#ulicaibrojVoznja').val()}`,
                    NaseljenoMesto: `${$('#mestoVoznja').val()}`,
                    PozivniBrojMesta: `${$('#postanskiBrojVoznja').val()}`,
                };

                lokacija.Adresa = adresa;
                voznja.Lokacija = lokacija;

                // OVDE IDE PARSIRANJE VOZNJE I AJAKS!


                $.ajax({
                    type: 'POST',
                    url: '/api/Voznja',
                    data: JSON.stringify(voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Vasa voznja je narucena :)");
                            $(location).attr('href', 'single.html')
                        }
                    }
                })

            });

            //OTKAZ VOZNJE KOD KLIJENATA
            $(document).on("click", "#otkaziVoznju", function () {
                //ovde ces ajaxom da saljes i da menjas voznje :)
                //i ako je nju formirao dispecer onda ne moze da se otkaze i to je to i ispise se poruka :)

                id = $(this).val() + ";" + localStorage.getItem("korisnik");
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja/',
                    //     contentType: 'application/json; charset=utf-8',
                    data: {
                        "id": id
                    },
                    //   dataType: 'json',
                    success: function (data) {
                        if (data==null) { alert("Ova voznja ne moze biti otkazana jer je dispacer formirao"); } else {
                            let tabelaVoznji = "<table border='1'><tr><td>Id voznje</td><td>Datum i vreme</td><td>Tip automobila</td><td>Status voznje</td><td colspan=\"2\"></td></tr>";
                            for (voznja in data) {
                                tabelaVoznji += `<tr>
                                                    <td>${data[voznja].Id}</td>
                                                    <td>${data[voznja].DatumVreme}</td>
                                                    <td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                    <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                    `;
                                if (data[voznja].StatusVoznje == 0) {


                                    tabelaVoznji += `
                                                    <td><button id="otkaziVoznju" value="${data[voznja].Id}">Otkazi</button></td>
                                                    <td><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                        </tr>`;
                                } else {
                                    tabelaVoznji += `
                                                    <td colspan=\"2\"></td>
                                                        </tr>`;
                                }
                            }
                            tabelaVoznji += "</table>";
                            $("#tabelaVoznji").html(tabelaVoznji);

                            //treba da se otvori komentar za voznju :)
                        }
                    }
                })

            });
            var voznjaKojaSeMenja = '';
            $(document).on("click", "#izmeniVoznju", function () {
                //ovde ces ajaxom da saljes i da menjas voznje :)

                //pokazem stranicu za izmenu i onda pokupim podatke i posaljem preko ajaxa i zamenimi vratim tabelu
                let informacije = "<br />Izmena voznje<table border='1'>";
                // Tabela ima objekat voznja + tip auta da se izabere
                informacije += `  <tr>        
                                <td>X koorginata</td>
                                    <td><input type=\"text\" id=\"xIzmena\"/></td>
                            </tr>

                             <tr>        
                                <td>Y koorginata</td>
                                    <td><input type=\"text\" id=\"yIzmena\"/></td>
                            </tr>

                             <tr>        
                                <td>Ulica i broj</td>
                                    <td><input type=\"text\" id=\"ulicaibrojIzmena\"/></td>
                            </tr>

                            <tr>        
                                <td>Mesto</td>
                                    <td><input type=\"text\" id=\"mestoIzmena\"/></td>
                            </tr>

                            <tr>        
                                <td>Postanski broj</td>
                                    <td><input type=\"text\" id=\"postanskiBrojIzmena\"/></td>
                            </tr>
                             <tr>        
                                <td>Tip automobila:</td>
                                    <td>
                                    <select name="Tip" id="automobilIzmena">
                                        <option>
                                            Putnicki
                                        </option>
                                        <option>
                                            Kombi
                                        </option>
                                    </select>
                                </td>
                            </tr>
                                <tr>      
                                    <td colspan=\"2\"><button id="izmenaVoznjeForma">Sacuvaj izmene</button></td>
                            </tr>
                                `;
                informacije += "</table><br />";
                $('#izmenaPojedinacneVoznjeDiv').html(informacije);
                alert($(this).val() + " voznja se memanja");
                voznjaKojaSeMenja = $(this).val();
            });


            $(document).on("click", "#izmenaVoznjeForma", function () {
                    //preuzmi iz tabele i posalji ajaksom i sakrij formu
                let ime = localStorage.getItem("korisnik");
                let ajdi = voznjaKojaSeMenja;
                let voznja = {
                    Id: ajdi,
                    idKorisnik: ime,
                    Lokacija: `${""}`,
                    Automobil: `${$('#automobilIzmena').val()}`,
                };

                let lokacija = {
                    X: `${$('#xIzmena').val()}`,
                    Y: `${$('#yIzmena').val()}`,
                    Adresa: `${""}`,
                };


                let adresa = {
                    UlicaBroj: `${$('#ulicaibrojIzmena').val()}`,
                    NaseljenoMesto: `${$('#mestoIzmena').val()}`,
                    PozivniBrojMesta: `${$('#postanskiBrojIzmena').val()}`,
                };
                lokacija.Adresa = adresa;
                voznja.Lokacija = lokacija; // ovo saljem post metodom


                $.ajax({
                    type: 'POST',
                    url: '/api/IzmeniVoznju',
                    data: JSON.stringify(voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) { 
                        alert("Uspesna izmena");
                        $(location).attr('href', 'single.html');

                    }
                })


            });
        });


    </script>
</head>
<body>

    <nav class="navbar navbar-default" id="naki" >
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" id="korisnikProfil" href="#"><p id="wel"></p></a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li><a id="pocetnaStranica" href="#">POCETNA</a></li>
                    <li><a id="dodajVozaca" href="#">DODAJ VOZACA</a></li>
                    <li><a id="naruciVoznju" href="#">NARUCI VOZNJU</a></li>
                    <li><a id="promeniLokaciju" href="#">PROMENI LOKACIJU</a></li>
                    <li><a id="odlogovanje" href="#">ODJAVI SE</a></li>

                </ul>
            </div>
        </div>
    </nav>

    <!-- First Container -->
    <div id="pocetna1" class="container-fluid bg-1 text-center">
        <h3 class="margin">Dobrodosli!</h3>
        <img src="flamingo3.jpg" class="img-responsive img-circle margin" style="display:inline" alt="Bird" width="350" height="350">
        <h3>064 309 3116</h3>
    </div>
    <!-- Second Container -->


    <div id="profil" style="width:800px; margin:0 auto;">

        PROFIL
    </div>

  


    <div id="korisnik" style="width:800px; margin:0 auto;">
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje </h3>
        <hr />
        <div id="tabelaVoznji">
            CAO KORISNICE ovde ide njegova tabela :) .html cu gore
        </div>
        <hr />

        <div id="izmenaPojedinacneVoznjeDiv">
            ovde ide tabela za izmenu
        </div>

    </div>

    <div id="dispecer">

        CAO DISPECERU

    </div>

    <div id="vozac">

        CAO VOZACU

    </div>

    <div id="dodavanjeKorisnikaDiv" style="width:800px; margin:0 auto;">
        DODAJEM KORISNIKA ODJE
    </div>

    <div id="dugmeIzmeni" style="width:800px; margin:0 auto;">
        <button id="izmeni">Promeni informacije</button><br />
    </div>

    <div id="dugmeDodajVozaca" style="width:800px; margin:0 auto;">
        <button id="subBut">Dodaj vozaca</button>
    </div>

    <div id="promeniLokacijuDiv" style="width:800px; margin:0 auto;">

        PROMENI LOCATION
    </div>

    <div id="dugmePromeniLokacijuDiv" style="width:800px; margin:0 auto;">
        <button id="promeniLokacijuBut">Promeni</button>
    </div>

    <div id="naruciVoznjuDiv" style="width:800px; margin:0 auto;">

        NARUCI VOZNJU
    </div>

    <div id="dugmeNaruciVoznjuDiv" style="width:800px; margin:0 auto;">
        <button id="naruciVoznjuBut">Naruci</button>
    </div>




    <div id="pocetna" class="container-fluid bg-2 text-center">
        <h3 class="margin">What Am I?</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>
        <a href="#" class="btn btn-default btn-lg">
            <span class="glyphicon glyphicon-search"></span> Search
        </a>
    </div>

    <br /> <footer class="container-fluid bg-4 text-center">
        <p>All rights reserved-Maja Djordjevic</p>
    </footer>

</body>
</html>
