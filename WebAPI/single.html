<!DOCTYPE html>
<html>
<head>
    <title>Falmingo taxi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="Scripts/jquery-1.10.2.js"></script>



    <style>
        body {
            font: 20px Montserrat, sans-serif;
            line-height: 1.8;
            color: black;
        }

        p {
            font-size: 16px;
        }

        textarea {
            resize: none;
        }

        .margin {
            margin-bottom: 45px;
        }

        .bg-1 {
            background-color: #1abc9c; /* Green */
            color: #ffffff;
        }

        .bg-2 {
            background-color: #474e5d; /* Dark Blue */
            color: #ffffff;
        }

        .bg-3 {
            background-color: #ffffff; /* White */
            color: #555555;
        }

        .bg-4 {
            background-color: #2f2f2f; /* Black Gray */
            color: #fff;
        }

        .container-fluid {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        .navbar {
            padding-top: 15px;
            padding-bottom: 15px;
            border: 0;
            border-radius: 0;
            margin-bottom: 0;
            font-size: 12px;
            letter-spacing: 5px;
        }

        .navbar-nav li a:hover {
            color: #1abc9c !important;
            font-size: 150%;
        }

        #korisnikProfil {
            color: #1abc9c;
        }

            #korisnikProfil:hover {
                background-color: #1abc9c;
                color: white;
                font-weight: bold;
                font-size: x-large;
            }

        th, td {
            padding: 4px;
            text-align: left;
        }

        #staraLokacijaP {
            color: #1abc9c;
            font-weight: bold;
        }

        #stariAuto {
            color: #1abc9c;
            font-weight: bold;
        }


        .dropbtn {
            background-color: #f8f8f8;
            color: #a7a5a6;
            padding: 14px;
            font-size: 13px;
            border: none;
        }

        /* The container <div> - needed to position the dropdown content */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dugmeSrc {
            background-color: #1abc9c;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 20px;
            border-radius: 12px;
            border: 3px solid #1abc9c;
        }

            .dugmeSrc:hover {
                background-color: white; /* Green */
                color: #1abc9c;
            }

        /* Dropdown Content (Hidden by Default) */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f8f8f8;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

            /* Links inside the dropdown */
            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
            }

        /* Change color of dropdown links on hover */

        .dropdown:hover .dropbtn {
            color: #1abc9c;
        }

        .izmenaTejbl {
            font-size: 24px;
        }

        #fitriranjeVoznji, #dispecerPretraga {
            color: #1abc9c;
            border: 1px solid rgba(26, 188, 156,.1);
            border-radius: 65%;
        }

        #blokiranje:hover {
            color: red;
        }


        #fitriranjeVoznji:hover {
            color: #1abc9c;
            border: 1px solid #1abc9c;
            border-radius: 65%;
        }

        #dispecerPretraga:hover {
            color: #1abc9c;
            border: 1px solid #1abc9c;
            border-radius: 65%;
        }



        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Change the background color of the dropdown button when the dropdown content is shown */



    </style>

    <script type="text/javascript">

     

        function getEnumStatus(id) {
            switch (id) {
                case 0: return "Kreirana";
                case 1: return "Formirana";
                case 2: return "Obradjena";
                case 3: return "Prihvacena";
                case 4: return "Otkazana";
                case 5: return "Neuspesna";
                case 6: return "Uspesna";
                case 7: return "Utoku";
            }
        }

        function getEnumTipAutomobila(id) {
            switch (id) {
                case 0: return "Svejedno";
                case 1: return "Putnicki";
                case 2: return "Kombi";

            }
        }
        function getEnumPol(id) {
            switch (id) {
                case 0: return "Zenski";
                case 1: return "Muski";
            }
        }

        $(document).ready(function () {
       
            $("#map1").hide();
            $("#voznjeNaCekanjuVozac").hide();
            $("#profil").hide();
            $("#korisnik").css("display", "none");
            $("#dispecer").css("display", "none");
            $("#vozac").css("display", "none");
            $("#dugmeIzmeni").hide();
            $('#dodajVozaca').hide();
            $('#promeniLokaciju').hide();
            $('#naruciVoznju').hide();
            $('#dodavanjeKorisnikaDiv').hide();
            $("#dugmeDodajVozaca").hide();
            $("#formiranjeVoznjeDispecer").hide();
            $("#dugmePromeniLokacijuDiv").hide();
            $("#promeniLokacijuDiv").hide();
            $("#naruciVoznjuDiv").hide();
            $("#dugmeNaruciVoznjuDiv").hide();
            $(".dropdown").hide();
            $("#blokiranje").hide();
            $("#block").hide();
            $("#fitriranjeVoznji").hide();
            $("#dispecerPretraga").hide();


            let uloga = '';
            let korisnikovAJDI = '';
            let korisnik1 = "";


            let ime = localStorage.getItem("korisnik");
            $("#wel").text(ime);

            let korisnik = {
                KorisnickoIme: `${ime}`,
            };

            if (ime == "") 
                $(location).attr('href', 'index.html');
         
            $.ajax({
                type: 'GET',//promeni na GET jer saljes samo korisnicko ime, ne moze zbog karaktera
                url: '/api/Prijava/' + ime,
                data: JSON.stringify(korisnik),
                contentType: 'application/json; charset=utf-8',
                async: false,
                dataType: 'json',
                success: function (data) {
                    korisnikovAJDI = data.Id;
                    korisnik1 = data;
                    uloga = data.Uloga; // 0 korisnik , 1 dispecer , 2 vozac

                    let myVar = setInterval(
                        function proveriStanje() {
                            if (uloga == 0) {//korisnik
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Korisnik/' + korisnikovAJDI,
                                    async: false,
                                    success: function (data) {
                                        if (data.Ban == 1) 
                                            $(location).attr('href', 'index.html');
                                    }
                                })
                            } else if (uloga == 2) {//vozac
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Vozac/' + korisnikovAJDI,
                                    async: false,
                                    success: function (data) {
                                        if (data.Ban == 1) 
                                            $(location).attr('href', 'index.html');
                                    }
                                })
                            }
                        }, 1000);



                    if (data.Uloga == 0) {
                        alert("Musterija logovana");
                        $("#korisnik").css("display", "block");
                        $("#korisnik").css("clear", "both");
                        $("#korisnik").css("position", "sticky");
                        $("#fitriranjeVoznji").show();
                        $('#naruciVoznju').show();
                        //Posalji zahtev za voznjom - da bi se na pocetnoj ispisala lista  // OVDE SAM MENJALA STAVILA SAM UMESTO POST ->GET*******************************
                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',
                            success: function (data) {
                                if (data.length != 0) {
                                    let sviPoz = 0;
                                    for (var v in data) {
                                        if (data[v].idKorisnik == korisnik1.Id) {
                                            if (data[v].StatusVoznje == 0 || (data[v].StatusVoznje == 6 && data[v].Komentar.Opis == " ") || data[v].StatusVoznje == 2) {
                                                sviPoz = 1;
                                                break;
                                            }
                                        }
                                    }
                                    let korisnikoveVoznje = 0;
                                    for (var v in data) {
                                        if (data[v].idKorisnik == korisnikovAJDI)
                                            korisnikoveVoznje = 1;
                                    }
                                    if (korisnikoveVoznje == 1) {
                                        let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                        tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                        tabelaVoznji += "<th>Komentar</th>";
                                        tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th>"
                                        if (sviPoz == 0) {
                                            tabelaVoznji += `</tr>`;
                                        } else {
                                            tabelaVoznji += "<th colspan =\"2\"></th></tr>";
                                        }
                                        for (voznja in data) {
                                            if (data[voznja].idKorisnik == korisnikovAJDI) {
                                                var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                                var datum =
                                                    currentdate.getUTCFullYear() + "/" +
                                                    ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                    ("0" + currentdate.getUTCDate()).slice(-2);

                                                var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                    ("0" + currentdate.getUTCMinutes()).slice(-2);
                                                tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>

                                                                        <td>${korisnik1.Ime} ${korisnik1.Prezime}</td>`;
                                                if (data[voznja].idVozac != " ") {

                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Vozac/' + data[voznja].idVozac,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                                }

                                                if (data[voznja].idDispecer != " ") {

                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                                }

                                                tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;

                                                if (data[voznja].Iznos != "0") {
                                                    tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                                } else {
                                                    tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                                }

                                                if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                    tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                                } else {
                                                    tabelaVoznji += `<td> </td>`;

                                                }

                                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;
                                                if (data[voznja].StatusVoznje == 0) {


                                                    tabelaVoznji += `
                                                                        <td><button id="otkaziVoznju" value="${data[voznja].Id}">Odustani</button></td>
                                                                        <td><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                                            </tr>`;
                                                }
                                                else if (data[voznja].StatusVoznje == 2) {
                                                    tabelaVoznji += `
                                                                        <td align="center" colspan="2"><button id="izmeniVoznju" value="${data[voznja].Id}">Izmeni</button></td>
                                                                            </tr>`;
                                                }

                                                else if (data[voznja].StatusVoznje == 6 && data[voznja].Komentar.Opis == " ") {
                                                    tabelaVoznji += `
                                                                        <td align="center" colspan="2"><button id="korisnikDodajKomentar" value="${data[voznja].Id}">Dodaj komentar</button></td>
                                                                            </tr>`;

                                                }

                                                else {
                                                    if (sviPoz == 0) {
                                                        tabelaVoznji += `</tr>`;
                                                    } else {
                                                        tabelaVoznji += `
                                                                        <td colspan=\"2\"></td>
                                                                            </tr>`;
                                                    }
                                                }
                                            }
                                        }
                                        tabelaVoznji += "</table>";
                                        $("#tabelaVoznji").html(tabelaVoznji);

                                    } else {
                                        $("#tabelaVoznji").html("<h3 align=\"center\">Nemate voznje</h3>");

                                    }
                                }
                            }
                        })

                    } else if (data.Uloga == 1) {
                        alert("Dispecer logovan");
                        $('#dodajVozaca').show();
                        $(".dropdown").show();
                        $("#blokiranje").show();
                        $("#fitriranjeVoznji").show();
                        $("#lala").hide();
                        $("#lala1").hide();
                        $("#lala2").hide();
                        $("#dispecer").css("display", "block");
                        $("#dispecer").css("clear", "both");
                        $("#dispecer").css("position", "sticky");

                        let voznje = [];
                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',//ajdidispecera
                            success: function (data) {
                                voznje = data;
                                let imaDispecer = 0;
                                for (voznja in data) {
                                    if (data[voznja].idDispecer == korisnikovAJDI)
                                        imaDispecer = 1;
                                }

                                if (imaDispecer != 1) {
                                    $("#tabelaVoznjiDispecera").html("<h4 align=\"center\">Trenutno nemate ni jenu voznju :)</h4>");

                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].idDispecer == korisnikovAJDI) {
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {


                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }

                                            tabelaVoznji += `<td>${korisnik1.Ime} ${korisnik1.Prezime}</td>
                                                                        <td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>
                                                                        `;

                                        }
                                    }
                                    tabelaVoznji += "</table>";
                                    $("#tabelaVoznjiDispecera").html(tabelaVoznji);


                                }
                                ///ISPIS SVIH VOZNJI
                                if (data.length == 0) {
                                    $("#tabelaVoznjiDispecera").html("<h4 align=\"center\">Trenutno nema voznji u sistemu :)</h4>");

                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                                    for (voznja in data) {
                                        var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                        var datum =
                                            currentdate.getUTCFullYear() + "/" +
                                            ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                            ("0" + currentdate.getUTCDate()).slice(-2);

                                        var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                            ("0" + currentdate.getUTCMinutes()).slice(-2);
                                        tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                        if (data[voznja].idKorisnik != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                        }

                                        if (data[voznja].idVozac != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Vozac/' + data[voznja].idVozac,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                        }


                                        if (data[voznja].idDispecer != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                            })

                                        } else {
                                            tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                        }

                                        tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                        if (data[voznja].Iznos != "0") {
                                            tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                        } else {
                                            tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                        }

                                        if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                            tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                        } else {
                                            tabelaVoznji += `<td> </td>`;

                                        }
                                        tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>
                                                                        `;

                                    }
                                    tabelaVoznji += "</table>";
                                    $("#tabelaSvihVoznji").html(tabelaVoznji);
                                }

                            }
                        })
                    }
                    else if (data.Uloga == 2) {
                        alert("Vozac logovana");
                        $("#lala").hide();
                        $("#voznjeNaCekanjuVozac").show();

                        $("#lala1").hide();
                        $("#lala2").hide();
                        $('#promeniLokaciju').show();
                        $("#fitriranjeVoznji").show();//dodala , to treba i kod dispecera

                        $("#vozac").css("display", "block");
                        $("#vozac").css("clear", "both");
                        $("#vozac").css("position", "sticky");


                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',
                            success: function (data) {

                                let ima = 0;
                                for (voznja in data) {
                                    if (data[voznja].idVozac == korisnikovAJDI)
                                        ima = 1;
                                }

                                if (ima != 1) {
                                    $("#tabelaVoznjiVozaca").html("<h3 align=\"center\">Nemate ni jednu voznju</h3>");
                                } else {

                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th><th colspan =\"2\"></th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].idVozac == korisnikovAJDI) {

                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }



                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }




                                            if (data[voznja].idDispecer != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;

                                            tabelaVoznji += `<td><button value="${data[voznja].Id}" id="neuspesnaDugme">Neuspesna</button></td><td><button value="${data[voznja].Id}" id="uspesnaDugme">Uspesna</button></td></tr>`;
                                        }

                                    }
                                    $("#tabelaVoznjiVozaca").html(tabelaVoznji);
                                }

                                let imaSlob = 0;
                                for (voznja in data) {
                                    if (data[voznja].StatusVoznje == 0)
                                        imaSlob = 1;
                                }

                                if (imaSlob != 1) {
                                    $("#tabelaVoznjiNaCekanju").html("<h4 align=\"center\">Trenutno nema voznji u na cekanju :)</h4>");
                                } else {
                                    let tabelaVoznji = `<table border='1'><tr><th>Id</th><th>Musterija</th><th>Vozac</th><th>Dispecer</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th><th></th></tr>";

                                    for (voznja in data) {
                                        if (data[voznja].StatusVoznje == 0) {
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum =
                                                currentdate.getUTCFullYear() + "/" +
                                                ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                                ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                                ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr>
                                                                        <td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idKorisnik}</td>`;
                                            }



                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idVozac}</td>`;
                                            }




                                            if (data[voznja].idDispecer != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Dispecer/' + data[voznja].idDispecer,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })

                                            } else {
                                                tabelaVoznji += `<td>${data[voznja].idDispecer}</td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>
                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        `;
                                            tabelaVoznji += `<td><button value=${data[voznja].Id} id="prihvatiDugme">Prihvati</button></td></tr>`;

                                        }
                                    }

                                    tabelaVoznji += "</table>";
                                    $("#tabelaVoznjiNaCekanju").html(tabelaVoznji);

                                }
                            }
                        })

                    }
                }

            })

            //LINK U MENIJU PROFIL
            $("#korisnikProfil").click(function () {

                var sadrzaj = $("#izmeni").text();

                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {

                    if (sadrzaj == "Promeni informacije") {
                        $("#block").hide();
                        $("#map1").hide();

                        $("#korisnik").css("display", "none");
                        $("#dispecer").css("display", "none");
                        $("#vozac").css("display", "none");
                        $("#tabelaPrikaza").hide();
                        $("#filtriranje").hide();
                        $("#pretraga").hide();
                        $("#tabelaPretraga").hide();

                        $("#voznjeNaCekanjuVozac").hide();


                        $("#naruciVoznjuDiv").hide();
                        $("#dugmeNaruciVoznjuDiv").hide();

                        $('#izmenaPojedinacneVoznjeDiv').hide();
                        $('#neuspesnaVoznjaKomentarDiv').hide();

                        $("#dugmePromeniLokacijuDiv").hide();
                        $("#dugmeDodajVozaca").hide();
                        $("#formiranjeVoznjeDispecer").hide();

                        $("#obradaVoznjeDispecer").hide();

                        $("#odabirVozaca").hide();


                        $('#dodavanjeKorisnikaDiv').hide();
                        $("#promeniLokacijuDiv").hide();
                        $("#pocetna").hide();
                        $("#pocetna1").hide();
                        $('#profil').show(500);
                        let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaObicna\" border='1'>";
                        informacije += `

                                                    <tr>
                                                        <td>Korisnicko ime:</td>
                                                        <td>${korisnik1.KorisnickoIme}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Lozinka:</td>
                                                        <td>${korisnik1.Lozinka}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Ime:</td>
                                                        <td>${korisnik1.Ime}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Prezime:</td>
                                                        <td>${korisnik1.Prezime}</td>
                                                    </tr>
                                                     <tr>
                                                        <td>Telefon:</td>
                                                        <td>${korisnik1.KontaktTelefon}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Email:</td>
                                                        <td>${korisnik1.Email}</td>
                                                    </tr>
                                                        <tr>
                                                        <td>JMBG:</td>
                                                        <td>${korisnik1.JMBG}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Pol:</td>
                                                        <td>${getEnumPol(korisnik1.Pol)}</td>
                                                    </tr>

                                                        `;
                        informacije += "</table>";
                        $('#profil').html(informacije);
                        $('#dugmeIzmeni').show(500);
                    } else {
                        alert("Niste sacuvali izmene.");
                        $("#izmeni").css("background-color", "#ff4d4d");

                    }
                }

            });

            //LINK POCETNA STRANICA
            $("#pocetnaStranica").click(function () {

                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {
                    var sadrzaj = $("#izmeni").text();
                    if (sadrzaj == "Promeni informacije") {

                        $(location).attr('href', 'single.html');

                        if (uloga == 0) {
                            $("#korisnik").css("display", "block");
                            $("#korisnik").css("clear", "both");
                            $("#korisnik").css("position", "sticky");
                        } else if (uloga == 1) {
                            $("#dispecer").css("display", "block");

                            //dispecer tabele
                        } else if (uloga == 2) {
                            $("#vozac").css("display", "block");
                        }
                        $("#filtriranje").hide();
                        $("#tabelaPrikaz").hide();
                        $("#naruciVoznjuDiv").hide();
                        $("#dugmeNaruciVoznjuDiv").hide();
                        $('#dodavanjeKorisnikaDiv').hide();
                        $("#dugmeDodajVozaca").hide();
                        $("#formiranjeVoznjeDispecer").hide();
                        $("#obradaVoznjeDispecer").hide();

                        $("#odabirVozaca").hide();


                        $("#profil").hide();
                        $("#pocetna1").show();
                        $("#pocetna").show();
                        $('#dugmeIzmeni').hide();

                        $("#promeniLokacijuDiv").hide();
                        $("#dugmePromeniLokacijuDiv").hide();
                    } else {
                        alert("Niste sacuvali izmene.");
                        $("#izmeni").css("background-color", "#ff4d4d");

                    }
                }


            });

            //DUGME PROMENI INFORMACJE _ SACUVAJ
            $("#izmeni").click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    $("#izmeni").text("Sacuvaj");
                    $("#dugmeDodajVozaca").hide();
                    $("#formiranjeVoznjeDispecer").hide();

                    $('#subBut').hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();

                    $("#naruciVoznjuDiv").hide();
                    $("#dugmeNaruciVoznjuDiv").hide();


                    $("#tabelaObicna").hide(500);
                    let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaNeobicna\" border='1'>";
                    informacije += ` <tr>
                                                        <td>Korisnicko ime:</td>
                                                        <td><input type=\"text\" id=\"korisnickoImeIzmeni\" required pattern="[0-9a-zA-Z]{4,}" title="Minimum 4 karaktera" value=\"${korisnik1.KorisnickoIme}\" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Lozinka:</td>
                                                        <td><input type=\"text\" id=\"lozinkaIzmeni\" required pattern="[0-9a-zA-Z]{8,}" title="Minimum 8 karakreta" value=\"${korisnik1.Lozinka}\" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Ime:</td>
                                                        <td><input type=\"text\" id=\"imeIzmeni\" required pattern="[a-zA-Z]{2,}" value=\"${korisnik1.Ime}\" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Prezime:</td>
                                                        <td><input type=\"text\" id=\"prezimeIzmeni\" required pattern="[a-zA-Z]{2,}" value=\"${korisnik1.Prezime}\" /></td>
                                                    </tr>
                                                     <tr>
                                                        <td>Telefon:</td>
                                                        <td><input type=\"text\" id=\"telefonIzmeni\" pattern="[0-9]{9,}" required value=\"${korisnik1.KontaktTelefon}\" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Email:</td>
                                                        <td><input type=\"email\" id=\"emailIzmeni\"  required value=\"${korisnik1.Email}\" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>JMBG:</td>
                                                        <td>${korisnik1.JMBG}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Pol:</td>
                                                        <td>${getEnumPol(korisnik1.Pol)}</td>
                                                    </tr>
                                                    `;
                    informacije += "</table>";
                    $('#profil').html(informacije);
                } else {
                    //ako je udjeno u to
                    $("#izmeni").css("background-color", '');

                    // ovde cu validaciju
                    let x1 = document.getElementById("korisnickoImeIzmeni");
                    let x2 = document.getElementById("lozinkaIzmeni");
                    let x3 = document.getElementById("imeIzmeni");
                    let x4 = document.getElementById("prezimeIzmeni");
                    let x5 = document.getElementById("telefonIzmeni");
                    let x6 = document.getElementById("emailIzmeni");

                    if (!x1.checkValidity() || !x2.checkValidity() || !x3.checkValidity() || !x4.checkValidity() || !x5.checkValidity() || !x6.checkValidity()) {
                        alert("Morate uneti sva polja ispravno!");
                    } else {

                        let korisnik = {
                            KorisnickoIme: `${$('#korisnickoImeIzmeni').val()}`,
                            Lozinka: `${$('#lozinkaIzmeni').val()}`,
                            Ime: `${$('#imeIzmeni').val()}`,
                            Prezime: `${$('#prezimeIzmeni').val()}`,
                            Email: `${$('#emailIzmeni').val()}`,
                            KontaktTelefon: `${$('#telefonIzmeni').val()}`,
                            Uloga: uloga,
                        };

                        //put da promenis saljes novog i stari id pa get da dobijes

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Korisnik/' + korisnik1.Id,
                            data: JSON.stringify(korisnik),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                if (!data) {
                                    alert("Zauzeto korisnicko ime!");
                                } else {

                                    //get u zavisnosti od uloge.
                                    if (uloga == 0) {//get za korisnika

                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Korisnik/' + korisnik1.Id,
                                            async: false,
                                            success: function (data) {
                                                korisnik1 = data;
                                            }
                                        })


                                    } else if (uloga == 2) {

                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Vozac/' + korisnik1.Id,
                                            async: false,
                                            success: function (data) {
                                                korisnik1 = data;
                                            }
                                        })

                                    } else if (uloga == 1) {

                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Dispecer/' + korisnik1.Id,
                                            async: false,
                                            success: function (data) {
                                                korisnik1 = data;
                                            }
                                        })
                                    }

                                    $("#izmeni").text("Promeni informacije");

                                    localStorage.setItem("korisnik", korisnik1.KorisnickoIme);
                                    var ime = localStorage.getItem("korisnik");
                                    $("#wel").text(ime);
                                    $("#tabelaNeobicna").hide(500);
                                    let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\" >Vasi licni podaci</h2><hr /><br /><table class=\"izmenaTejbl\" id=\"tabelaObicna\" border='1'>";
                                    informacije += ` <tr>
                                                        <td>Korisnicko ime:</td>
                                                        <td>${korisnik1.KorisnickoIme}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Lozinka:</td>
                                                        <td>${korisnik1.Lozinka}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Ime:</td>
                                                        <td>${korisnik1.Ime}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Prezime:</td>
                                                        <td>${korisnik1.Prezime}</td>
                                                    </tr>
                                                     <tr>
                                                        <td>Telefon:</td>
                                                        <td>${korisnik1.KontaktTelefon}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Email:</td>
                                                        <td>${korisnik1.Email}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>JMBG:</td>
                                                        <td>${korisnik1.JMBG}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Pol:</td>
                                                        <td>${getEnumPol(korisnik1.Pol)}</td>
                                                    </tr>


                                                        `;
                                    informacije += "</table>";
                                    $('#profil').html(informacije);
                                }
                            }
                        })
                    }
                }
            });


            //IZGLED ZA DODAVANJE VOZACA  , link u meniju
            $('#dodajVozaca').click(function () {
                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#dispecer").css("display", "none");
                    $("#block").hide();
                    $("#map1").show();
                    $("#filtriranje").hide();
                    $("#tabelaPrikaz").hide();
                    $("#pretraga").hide();
                    $("#tabelaPretraga").hide();
                    $("#dugmeDodajVozaca").show();
                    $("#formiranjeVoznjeDispecer").hide();
                    $("#odabirVozaca").hide();
                    $("#subBut").show();
                    $("#profil").hide();
                    $("#pocetna1").hide();
                    $("#pocetna").hide();
                    $('#dugmeIzmeni').hide();
                    $("#promeniLokacijuDiv").hide();
                    $('#dodavanjeKorisnikaDiv').show();
                    $("#promeniLokacijuDiv").hide();
                    $("#dugmePromeniLokacijuDiv").hide();
                    $("#obradaVoznjeDispecer").hide();

                    let informacije = "<h2  align=\"center\" style=\"color:#1abc9c\" >Unesite podatke za vozaca</h2><hr /><table class=\"izmenaTejbl\" id=\"tabelaVozaca\" border='1'>";
                    informacije += `<tr>
                                                        <td>Ime:</td>
                                                        <td><input type=\"text\" id=\"imeVozac\" required title="Obavezno"/></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Prezime:</td>
                                                        <td><input type=\"text\" id=\"prezimeVozac\" required title="Obavezno" /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Korisnicko ime:</td>
                                                        <td><input type=\"text\" id=\"korisnickoImeVozac\"  title="Minimum 4 karaktera/cifara" pattern="[0-9a-zA-Z]{4,}" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Lozinka:</td>
                                                        <td><input type=\"text\" id=\"lozinkaVozac\"  title="Minimum 8 karaktera/cifara" pattern="[0-9a-zA-Z]{8,}" required /></td>
                                                    </tr>
                                                     <tr>
                                                        <td>JMBG:</td>
                                                        <td><input type=\"text\" id=\"jmbgVozac\"  pattern="[0-9]{13}"  title="13 cifara" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Telefon:</td>
                                                        <td><input type=\"text\" pattern="[0-9]{9,}" id=\"telefonVozac\"  title="Minimum 9 cifara" required /></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Emal:</td>
                                                        <td><input type=\"email\" id=\"emailVozac\" title="ex. flamingo@taxi.com" required /></td>
                                                    </tr>

                                                    <tr>
                                                    <td>Pol: </td>
                                                    <td>
                                                        <select name="Pol" id="polVozac">
                                                            <option>
                                                                Zenski
                                                            </option>
                                                            <option>
                                                                Muski
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>Godiste auta</td>
                                                        <td><input type=\"text\" min=2013 max=2018   pattern="[0-9]{4}" id=\"godisteAutaVozac\" title="Minimum 4 cifara" required /></td>
                                                </tr>

                                                <tr>
                                                    <td>Registracija auta</td>
                                                        <td><input type=\"text\" id=\"registracijaAutaVozac\" pattern="[A-Z]{2}[0-9]{3}[A-Z]{2}" title="ex.NS002PU" required /></td>
                                                </tr>

                                                 <tr>
                                                    <td>Tip auta: </td>
                                                    <td>
                                                        <select name="Tip" id="tipAuta">
                                                            <option>
                                                                Putnicki
                                                            </option>
                                                            <option>
                                                                Kombi
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                        `;

                    informacije += "</table>";
                    $('#dodavanjeKorisnikaDiv').html(informacije);

                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");
                }

            });

            //LOGOUT
            $('#odlogovanje').click(function () {
                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {
                    var sadrzaj = $("#izmeni").text();
                    if (sadrzaj == "Promeni informacije") {
                        localStorage.setItem("korisnik", "");
                        $(location).attr('href', 'index.html');
                    } else {
                        alert("Niste sacuvali izmene.");
                        $("#izmeni").css("background-color", "#ff4d4d");

                    }
                }



            });
            //DODAVANJE VOZAZCA, sta se radi kada se klikne na dugme
            $('#subBut').click(function () {
                //validacija 
                let x = document.getElementById("imeVozac");
                let y = document.getElementById("prezimeVozac");
                let ub = document.getElementById("korisnickoImeVozac");
                let m = document.getElementById("lozinkaVozac");
                let p = document.getElementById("jmbgVozac");
                let p1 = document.getElementById("telefonVozac");
                let p7 = document.getElementById("godisteAutaVozac");
                let p8 = document.getElementById("registracijaAutaVozac");
                if (!x.checkValidity() || !y.checkValidity() || !ub.checkValidity() || !m.checkValidity() || !p.checkValidity() || !p1.checkValidity() || !p7.checkValidity() || fulAdresa == '') {
                    alert("Nisu uspravno unešena sva polja ili lokacija nije odabrana \n Zadržite kursor na polje da biste videli očekivanu vrednost.");
                } else {
                    
                    let vozac = {
                        KorisnickoIme: `${$('#korisnickoImeVozac').val()}`,
                        Lozinka: `${$('#lozinkaVozac').val()}`,
                        Ime: `${$('#imeVozac').val()}`,
                        Prezime: `${$('#prezimeVozac').val()}`,
                        Email: `${$('#emailVozac').val()}`,
                        KontaktTelefon: `${$('#telefonVozac').val()}`,
                        Pol: `${$('#polVozac').val()}`,
                        JMBG: `${$('#jmbgVozac').val()}`,
                        Lokacija: `${""}`,
                        Automobil: `${""}`,
                    };

                    let niz = fulAdresa.split(",");

                    let lokacija = {
                        X: `${niz[0]}`,
                        Y: `${niz[1]}`,
                        Adresa: `${""}`,
                    };

                    let adresa = {
                        UlicaBroj: `${niz[2]}`,
                        NaseljenoMesto: `${niz[3]}`,
                        PozivniBrojMesta: `${''}`,
                    };

                    lokacija.Adresa = adresa;

                    let automobil = {
                        Godiste: `${$('#godisteAutaVozac').val()}`,
                        Registracija: `${$('#registracijaAutaVozac').val()}`,
                        Tip: `${$('#tipAuta').val()}`,
                    };

                    vozac.Lokacija = lokacija;
                    vozac.Automobil = automobil;
                    
                    $.ajax({
                        type: 'POST',
                        url: '/api/Vozac',
                        data: JSON.stringify(vozac),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data)
                                alert("Korisnicko ime zauzeto.")
                            else {
                                alert("Vozac dodat!")
                                $("#pocetna1").show();
                                $("#pocetna").show();
                                $(location).attr('href', 'single.html');

                                $("#dugmeDodajVozaca").hide();
                                $("#dodavanjeKorisnikaDiv").hide();
                                $("#promeniLokacijuDiv").hide();
                                $("#dugmePromeniLokacijuDiv").hide();
                            }
                        }
                    })
                }
            });


            //LINK U MENIJU - PROMENI LOKACIJU - VOZAC ima to
            $('#promeniLokaciju').click(function () {
                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {

                $("#map1").show();
                $("#voznjeNaCekanjuVozac").hide();
                
                $("#vozac").css("display", "none");

                let lokacija = '';
                $.ajax({
                    type: 'GET',
                    url: '/api/Lokacija/' + korisnik1.Id,
                    success: function (data) {
                        lokacija = data;
                        let staraLokacija = `<br />
                                            <details id="staraLokacijaP">
                                                <summary>Stara lokacija</summary>
                                                <p>X: ${lokacija.X}</p>
                                                <p>Y: ${lokacija.Y} </p>
                                                <p>Mesto: ${lokacija.Adresa.NaseljenoMesto}</p>
                                                <p>Ulica&Broj: ${lokacija.Adresa.UlicaBroj}</p>
                                            </details>`;


                        $('#staraLokacija').html(staraLokacija);

                    }
                })

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#pocetna1").hide();
                    $("#profil").hide();
                    $("#pocetna").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#dodavanjeKorisnikaDiv").hide();
                    $("#dugmeIzmeni").hide();
                    $("#tabelaPrikaza").hide();
                    $("#filtriranje").hide();
                    $("#promeniLokacijuDiv").show(500);
                    $("#dugmePromeniLokacijuDiv").show(500);

                    let informacije = "<h3>Nova lokacija</h3><table class=\"izmenaTejbl\" border='1'>";
                    informacije += `  <tr>
                                                    <td>X koorginata</td>
                                                        <td><input type=\"text\" id=\"xPromeni\" required /></td>
                                                </tr>

                                                 <tr>
                                                    <td>Y koorginata</td>
                                                        <td><input type=\"text\" id=\"yPromeni\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Ulica i broj</td>
                                                        <td><input type=\"text\" id=\"ulicaibrojPromeni\" required /></td>
                                                </tr>

                                                <tr>
                                                    <td>Mesto i postanski broj</td>
                                                        <td><input type=\"text\" id=\"mestoPromeni\" required /></td>
                                                </tr>

                                                    `;
                    informacije += "</table>";

                    $.ajax({
                        type: 'GET',
                        url: '/api/Automobil/' + korisnikovAJDI,
                        success: function (data) {
                            automobil = data;
                            let stariAuto = `<hr />
                                            <details id="stariAuto">
                                                <summary>Podaci o automobilu</summary>
                                                <p>Broj: ${automobil.Broj}</p>
                                                <p>Godiste: ${automobil.Godiste}</p>
                                                <p>Registracija: ${automobil.Registracija}</p>
                                                <p>Tip: ${getEnumTipAutomobila(automobil.Tip)}</p>

                                            <hr /><h3><b>Promeni podatke</b></h3><table>
                                            <tr><td>Broj auta:</td><td><input type="text" id="brojAuta" required></td></tr>
                                            <tr><td>Godiste auta:</td><td><input type="text" id="godAuta" required></td></tr>
                                            <tr><td>Registracija auta:</td><td><input type="text" id="regAuta" required></td></tr>
                                            <tr><td>Tip auta:</td><td>
                                            <select id="tipAuta">
                                            <option>Putnicki</option><option>Kombi</option>
                                            </select>
                                            </td></tr>
                                            <tr><td></td><td><button id="sacuvajAuto">Sacuvaj</button></td></tr>

                                            </table>

                                            </details><hr />`;
                            
                            $('#stariAuto').html(stariAuto);
                        }

                    })
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                    }
                }
            });
            $(document).on("click", "#sacuvajAuto", function () {
                let p = document.getElementById("brojAuta");
                let p1 = document.getElementById("godAuta");
                let p2 = document.getElementById("regAuta");

                if (!p.checkValidity() || !p1.checkValidity() || !p2.checkValidity()) {
                    alert("Morate uneti sva polja!");
                } else {
                    let automobil = {
                        Broj: `${$('#brojAuta').val()}`,
                        Registracija: `${$('#regAuta').val()}`,
                        Godiste: `${$('#godAuta').val()}`,
                        Tip: `${$('#tipAuta').val()}`,

                    };
                    //putom menjam
                    $.ajax({
                        type: 'PUT',
                        url: '/api/Automobil/' + korisnikovAJDI,
                        data: JSON.stringify(automobil),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                alert("Uspesno promenjeno");
                                $(location).attr('href', 'single.html');
                            }

                        }
                    })
                }
            });


            //DUGME U DA SE PROMENI LOKACIJA U VOZACU
            $("#promeniLokacijuBut").click(function () {
                if (fulAdresa == '') {
                    alert("Odaberite adresu!");
                } else {
                    let zauzet = false;
                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac/' + korisnikovAJDI,
                        async: false,
                        success: function (data) {
                            if (data.Zauzet == 1)
                                zauzet = true;
                        }
                    })
                    if (!zauzet) {
                        let ime = localStorage.getItem("korisnik");

                        let niz = fulAdresa.split(",");

                        let lokacija = {
                            X: `${niz[0]}`,
                            Y: `${niz[1]}`,
                            Adresa: `${""}`,
                        };

                        let adresa = {
                            UlicaBroj: `${niz[2]}`,
                            NaseljenoMesto: `${niz[3]}`,
                            PozivniBrojMesta: `${''}`,
                        };

                        lokacija.Adresa = adresa; //NOVA LOKACIJA

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Lokacija/' + korisnik1.Id,
                            data: JSON.stringify(lokacija),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Uspesno promenjena lokacija");
                                    $(location).attr('href', 'single.html');
                                }
                            }
                        })

                    } else {
                        alert("U toku voznje ste");
                    }
                }
            });


            //LINK U MENIJU NARUCI VOZNJU _ DISPECER to ima
            $('#naruciVoznju').click(function () {
                    if ($("#opis").val() == "") {
                        alert("Unesite komentar!");
                    } else {
                        var sadrzaj = $("#izmeni").text();
                        if (sadrzaj == "Promeni informacije") {

                            $("#korisnik").css("display", "none");
                            $('#izmenaPojedinacneVoznjeDiv').hide();
                            $("#tabelaPrikaza").hide();
                            $("#filtriranje").hide();
                            $("#map1").show();
                            $("#pocetna1").hide();
                            $("#profil").hide();
                            $("#pocetna").hide();
                            $("#dugmeDodajVozaca").hide();
                            $("#dodavanjeKorisnikaDiv").hide();
                            $("#dugmeIzmeni").hide();
                            $("#promeniLokacijuDiv").hide();
                            $("#dugmePromeniLokacijuDiv").hide();

                            $("#naruciVoznjuDiv").show();//tu dodajem tabelu
                            $("#dugmeNaruciVoznjuDiv").show();


                            let informacije = "<h2 align=\"center\" style=\"color:#1abc9c\">Naruči vožnju</h2><hr /><br /><table class=\"izmenaTejbl\" border='1'>";
                            // Tabela ima objekat voznja + tip auta da se izabere
                            informacije += `   <tr>
                                                    <td>Tip automobila:</td>
                                                        <td>
                                                        <select name="Tip" id="automobilVoznja">
                                                            <option>
                                                                Svejedno
                                                            </option>
                                                            <option>
                                                                Putnicki
                                                            </option>
                                                            <option>
                                                                Kombi
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>

                                                    `;
                            informacije += "</table>";
                            $('#naruciVoznjuDiv').html(informacije);
                        } else {
                            alert("Niste sacuvali izmene.");
                            $("#izmeni").css("background-color", "#ff4d4d");
                        }
                    }
                
            });

            //KADA SE KLIKNE NA DUGME NARUCI VOZNJU
            $("#naruciVoznjuBut").click(function () {
                if (fulAdresa == '') {
                    alert("Unesite lokaicju!");
                } else {
                    let voznja = {
                        Lokacija: `${""}`,
                        Automobil: `${$('#automobilVoznja').val()}`,
                        idKorisnik: korisnikovAJDI,
                        StatusVoznje: 0, // dodala sam taj deo
                        idDispecer: " ",
                        idVozac: " ",
                    };

                    let niz = fulAdresa.split(",");

                    let lokacija = {
                        X: `${niz[0]}`,
                        Y: `${niz[1]}`,
                        Adresa: `${""}`,
                    };

                    let adresa = {
                        UlicaBroj: `${niz[2]}`,
                        NaseljenoMesto: `${niz[3]}`,
                        PozivniBrojMesta: `${''}`,
                    };
                    lokacija.Adresa = adresa;
                    voznja.Lokacija = lokacija;

                    // OVDE IDE PARSIRANJE VOZNJE I AJAKS!

                    $.ajax({
                        type: 'POST',
                        url: '/api/Voznja',
                        data: JSON.stringify(voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                alert("Vasa voznja je narucena :)");
                                $(location).attr('href', 'single.html')
                            }
                        }
                    })
                }
                
            });

            var idVoznje = '';
            //OTKAZ VOZNJE KOD KLIJENATA
            $(document).on("click", "#otkaziVoznju", function () {
                idVoznje = $(this).val();
                $('#izmenaPojedinacneVoznjeDiv').show();

                id = $(this).val();
                let voznja = {
                    idKorisnik: korisnik1.Id,
                    StatusVoznje: 4,
                };
                
                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + id,
                    data: JSON.stringify(voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data == false) { alert("Ova voznja ne moze biti otkazana jer je dispacer formirao"); }
                        else {
                            let informacije = "<br />Molim Vas, ostavite komentar<table border='1'>";
                            informacije += `  <tr>
                                                    <td>Opis</td>
                                                        <td><input type=\"text\" id=\"opis\" required/></td>
                                                </tr>
                                                 <tr>
                                                    <td>Ocena:</td>
                                                        <td>
                                                        <select name="Ocena" id="ocena">
                                                            <option>0</option>
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                    <tr>
                                                        <td colspan=\"2\"><button style=\"background:#1acb9c\" id="dodajKomentar">OK</button></td>
                                                </tr>
                                                    `;
                            informacije += "</table><br />";
                            $("#otkaziVoznju").prop("disabled", true);
                            $("#izmeniVoznju").prop("disabled", true);
                   
                            $('#izmenaPojedinacneVoznjeDiv').html(informacije);
                           
                        }
                    }
                })

            });


            $(document).on("click", "#dodajKomentar", function () {
                $("#otkaziVoznju").prop("disabled", false);
                $("#izmeniVoznju").prop("disabled", false);
          

                alert("dodaj kom, posalji ajaxom" + $("#otkaziVoznju").val() + korisnikovAJDI);
                let o = $('#ocena').val();
                let x = document.getElementById("opis");

                if (!x.checkValidity() && o != "0") {
                    alert("Morate uneti sva komentar!");
                } else {
                    let ime = localStorage.getItem("korisnik");
                    let komentar = {
                        Opis: `${$('#opis').val()}`,
                        DatumObjave: `${""}`,
                        idKorisnik: ime,
                        idVoznja: idVoznje,
                        Ocena: `${$('#ocena').val()}`,
                    };

                    let voznja = {
                        Komentar: komentar,
                    };

                    $.ajax({
                        type: 'POST',
                        url: '/api/Komentar',
                        data: JSON.stringify(komentar),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                    })

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Voznja/' + idVoznje,
                        data: JSON.stringify(voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                alert("Uspesno dodeljen komentar voznji");
                                alert("2");
                                $(location).attr('href', 'single.html');
                            } else {
                                alert("Vec je postavljen komentar");
                            }
                        }
                    })
                }
            });


            var voznjaKojaSeMenja = '';
            $(document).on("click", "#izmeniVoznju", function () {
                //ovde ces ajaxom da saljes i da menjas voznje :)
                $("#map1").show();
                //ubaCi odje ajax poziv
                let idVoznje = $(this).val();

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja/' + idVoznje,
                    success: function (data) {
                        let staro = data;


                        let informacije = "<br />Izmena voznje<table border='1'>";
                        informacije += `  <tr>
                                                    <td>X koorginata</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.X}\"  id=\"xIzmena\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Y koorginata</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.Y}\" id=\"yIzmena\" required/></td>
                                                </tr>

                                                 <tr>
                                                    <td>Ulica i broj</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.Adresa.UlicaBroj}\" id=\"ulicaibrojIzmena\" required/></td>
                                                </tr>

                                                <tr>
                                                    <td>Mesto</td>
                                                        <td><input type=\"text\" disabled value=\"${staro.Lokacija.Adresa.NaseljenoMesto}\" id=\"mestoIzmena\" required/></td>
                                                </tr>

                                              
                                                 <tr>
                                                    <td>Tip automobila:</td>
                                                        <td>
                                                        <select name="Tip" id="automobilIzmena">`;

                        if (staro.Automobil == 0) {
                            informacije += `<option selected>Svejedno</option><option>Putnicki</option><option>Kombi</option></select>`;
                        } else if (staro.Automobil == 1) {
                            informacije += `<option>Svejedno</option><option selected>Putnicki</option><option>Kombi</option></select>`;
                        } else if (staro.Automobil == 2) {
                            informacije += `<option>Svejedno</option><option>Putnicki</option><option selected>Kombi</option></select>`;
                        }

                        informacije += `</td ></tr><tr><td colspan=\"2\"><button id="izmenaVoznjeForma">Sacuvaj izmene</button></td></tr></table><br />`;
                        $('#izmenaPojedinacneVoznjeDiv').show();

                        $('#izmenaPojedinacneVoznjeDiv').html(informacije);

                    }
                })
                alert($(this).val() + " voznja se memanja");
                voznjaKojaSeMenja = $(this).val();
            });


            $(document).on("click", "#izmenaVoznjeForma", function () {
                    let ime = localStorage.getItem("korisnik");
                    let ajdi = voznjaKojaSeMenja;
                    let voznja = {
                        Id: ajdi,
                        idKorisnik: korisnikovAJDI,
                        Automobil: `${$('#automobilIzmena').val()}`,
                    };
                
                let niz = fulAdresa.split(",");

                let lokacija = {
                    X: `${niz[0]}`,
                    Y: `${niz[1]}`,
                    Adresa: `${""}`,
                };

                let adresa = {
                    UlicaBroj: `${niz[2]}`,
                    NaseljenoMesto: `${niz[3]}`,
                    PozivniBrojMesta: `${''}`,
                };

                    lokacija.Adresa = adresa;
                    voznja.Lokacija = lokacija; // ovo saljem post metodom

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Voznja/' + ajdi,
                        data: JSON.stringify(voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            alert("Uspesna izmena");
                            $(location).attr('href', 'single.html');

                        }
                    })
            });

            $("#formirajVoznju").click(function () {

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    $("#block").hide();
                    $("#dispecer").css("display", "none");
                    $("#pretraga").hide();
                    $("#tabelaPretraga").hide();

                    $("#filtriranje").hide();
                    $("#tabelaPrikaz").hide();

                    $("#pocetna1").hide();
                    $("#profil").hide();
                    $("#pocetna").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#dodavanjeKorisnikaDiv").hide();
                    $("#dugmeIzmeni").hide();
                    $("#obradaVoznjeDispecer").hide();

                    $("#odabirVozaca").hide();
                    $("#map1").show();
                    $("#formiranjeVoznjeDispecer").show();//tu dodajem tabelu


                    let informacije = "<h2  align=\"center\" style=\"color:#1abc9c\" >Formiranje voznje</h2><hr /><br /><table class=\"izmenaTejbl\" border='1'>";
                    informacije += `           <tr>
                                                    <td>Tip automobila:</td>
                                                        <td>
                                                        <select name="Tip" id="automobilFormiranje">
                                                            <option>
                                                                Svejedno
                                                            </option>
                                                            <option>
                                                                Putnicki
                                                            </option>
                                                            <option>
                                                                Kombi
                                                            </option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                    <tr><td colspan="2"><button class=\"dugmeSrc\" id="formirajVoznjuDugme">Formiraj</button></td></tr>

                                                    `;
                    informacije += "</table>";
                    $('#formiranjeVoznjeDispecer').html(informacije);
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }

            });

            $(document).on("click", "#formirajVoznjuDugme", function () {
                if (fulAdresa == '') {
                    alert("Unesite lokaicju!");
                } else {
                    var sadrzaj = $("#izmeni").text();
                    if (sadrzaj == "Promeni informacije") {
                        alert("Saljem voznju na formiranje");

                        let tipAuta = $('#automobilFormiranje').val();
                        let bitno = true;
                        let imaVozaca = false;
                        if (tipAuta == "Svejedno")
                            bitno = false;

                        let idVozaca;
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac',
                            async: false,
                            contentType: 'application/json; charset=utf-8',
                            success: function (data) {
                                for (vozac in data) {
                                    if (!bitno) {
                                        if (data[vozac].Zauzet == 0) {
                                            imaVozaca = true;
                                            idVozaca = data[vozac].Id;
                                            break;
                                        }
                                    } else {
                                        if (data[vozac].Zauzet == 0 && getEnumTipAutomobila(data[vozac].Automobil.Tip) == tipAuta) {
                                            imaVozaca = true;
                                            idVozaca = data[vozac].Id;
                                            break;
                                        }
                                    }
                                }
                            }
                        })

                        if (imaVozaca == false) {
                            alert("Nema slobodnog vozaca");
                        } else {
                            let vozac = {
                                Zauzet: 1,
                                Ban: 2,
                            };

                            $.ajax({
                                type: 'PUT',
                                url: '/api/Vozac/' + idVozaca,
                                data: JSON.stringify(vozac),
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                success: function (data) {
                                    if (data)
                                        alert("Vozac je zauzet sada");
                                }
                            })

                            let voznja = {
                                Lokacija: `${""}`,
                                Automobil: `${$('#automobilFormiranje').val()}`,
                                idDispecer: korisnikovAJDI,
                                StatusVoznje: 1,
                                idKorisnik: " ",
                                idVozac: idVozaca,
                            };

                            let niz = fulAdresa.split(",");

                            let lokacija = {
                                X: `${niz[0]}`,
                                Y: `${niz[1]}`,
                                Adresa: `${""}`,
                            };

                            let adresa = {
                                UlicaBroj: `${niz[2]}`,
                                NaseljenoMesto: `${niz[3]}`,
                                PozivniBrojMesta: `${''}`,
                            };

                            lokacija.Adresa = adresa;
                            voznja.Lokacija = lokacija;

                            $.ajax({
                                type: 'POST',
                                url: '/api/Voznja',
                                data: JSON.stringify(voznja),
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                success: function (data) {
                                    if (data) {
                                        alert("Vasa voznja je formirana :)");
                                        $(location).attr('href', 'single.html')
                                    }
                                }
                            })
                        }
                    }
                    else {
                        alert("Niste sacuvali izmene.");
                        $("#izmeni").css("background-color", "#ff4d4d");
                    }
                }
            });


            $("#obradiVoznju").click(function () {

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {
                    alert("Obradjujem voznju");
                    $("#tabelaPretraga").hide();
                    $("#filtriranje").hide();
                    $("#tabelaPrikaz").hide();
                    $("#map1").hide();
                    $("#odabirVozaca").hide();
                    $("#pretraga").hide();
                    $("#dispecer").css("display", "none");
                    $("#block").hide();
                    $("#pocetna1").hide();
                    $("#profil").hide();
                    $("#pocetna").hide();
                    $("#dugmeDodajVozaca").hide();
                    $("#dodavanjeKorisnikaDiv").hide();
                    $("#dugmeIzmeni").hide();
                    $("#obradaVoznjeDispecer").show();
                    $("#formiranjeVoznjeDispecer").hide();

                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja', // uzimam sve voznje slobodne
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            let have = false;
                            for (var d in data) {
                                if (data[d].StatusVoznje == 0)
                                    have = true;
                            }

                            if (have) {
                                let tabelaVoznji = `<h2 align=\"center\" style=\"color:#1abc9c\" >Voznje na cekanju</h2><hr /><table border='1'><tr><th>Musterija</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th> <th  width=\"200px\"></th></tr>";
                                for (voznja in data) {
                                    if (data[voznja].StatusVoznje == 0) {
                                        var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                        var datum =
                                            currentdate.getUTCFullYear() + "/" +
                                            ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                            ("0" + currentdate.getUTCDate()).slice(-2);

                                        var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                            ("0" + currentdate.getUTCMinutes()).slice(-2);


                                        tabelaVoznji += `<tr>`


                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                            async: false,
                                            success: function (data) {
                                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                            }
                                        })


                                        tabelaVoznji += `<td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;





                                        tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td>
                                                                        <td><button value="${data[voznja].Id}" id="dodavanjeVoznjeVozacu">Dodeli vozacu</button></td>
                                                                        `;

                                    }
                                }
                                tabelaVoznji += "</table>";
                                $("#obradaVoznjeDispecer").html(tabelaVoznji);


                            } else {
                                let info = `<h3>Nema voznji na cekanju</h3><hr />`;
                                $("#obradaVoznjeDispecer").html(info);
                            }
                        }
                    })
                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");

                }
            });
            let odabranaVoznja = '';
            $(document).on("click", "#dodavanjeVoznjeVozacu", function () {
                odabranaVoznja = $(this).val();
                alert("Saljem voznju" + odabranaVoznja + "..treba da se otovori lista slobodnih vozaca");

                let voznja = {};
                let bul = 0;//0 /1
                //otvaram listu slobodnih vozaca sa dugmencetom dodaj ga , imace ime, prezime, lokaciju i tip auta
                //get metoda koja mi vraca slobodne vozace
                //get metoda treba da vrati sve vozace, i od njih trazis slobodnog i stavljas u listu, a odabrana voznja se vraca preko Voznje get id

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja/' + odabranaVoznja,
                    async: false,
                    success: function (data) {
                        voznja = data;
                    }
                })

                if (voznja.Automobil == 0) // svejedno
                    bul = 1;

                let dolaznaAdresa = voznja.Lokacija;

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    contentType: 'application/json; charset=utf-8',
                    async:false,
                    success: function (data) {
                        let data1 = [];
                        for (var vozac in data) {
                            if (bul == 0) {//bitan je auto
                                if (voznja.Automobil == data[vozac].Automobil.Tip && data[vozac].Zauzet == 0) { // ako se slazu tipovi auta i ako je slobodan
                                    data1.push(data[vozac]);
                                }
                            } else {
                                if (data[vozac].Zauzet == 0) { // ako se slazu tipovi auta i ako je slobodan
                                    data1.push(data[vozac]);
                                }
                            }
                        }

                        data = data1;//tu su mi odgovarajuci

                        if (data.length != 0) {
                            alert("Ima vozaca slobodnih");
                            $("#odabirVozaca").show();
                            let petNajblizih = [];
                            
                            if (data.length > 5) {

                                for (var vozac in data) {
                                    // c = √ ((xA − xB) ² + (yA − yB) ² )
                                    let rastojanje;
                                    rastojanje = Math.sqrt(Math.pow(dolaznaAdresa.X - data[vozac].Lokacija.X, 2) + Math.pow(dolaznaAdresa.Y - data[vozac].Lokacija.Y, 2));

                                    let vozac1 = {
                                        Id: data[vozac].Id,
                                        Rastojanje: rastojanje,
                                    }
                                    petNajblizih.push(vozac1);
                                }


                                petNajblizih.sort(function (a, b) {
                                    return a.Rastojanje - b.Rastojanje;
                                })
                                let petOnly = [];

                                for (var pet in petNajblizih) {
                                    for (var vozac in data) {
                                        if (data[vozac].Id == petNajblizih[pet].Id) {
                                            petOnly.push(data[vozac]);
                                        }

                                    }
                                }

                                data = petOnly; // xD
                            }
                            let tabelaVoznji = `<br /><hr /><h3  align=\"left\" style=\"color:#1abc9c\" >Izaberi vozaca</h3><hr /><table border='1'><tr><th>Ime</th><th>Prezime</th><th>Lokacija</th>`;
                            tabelaVoznji += "<th>Tip automobila</th><th></th></tr>";
                                for (var vozac in data) {

                                    tabelaVoznji += `<tr>

                                                                        <td>${data[vozac].Ime}</td>
                                                                        <td>${data[vozac].Prezime}
                                                                       </td>

                                                                        <td>
                                                                        ${data[vozac].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[vozac].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[vozac].Automobil.Tip)}</td>
                                                                        <td><button value="${data[vozac].Id}" id="dodavanjeVozacaVoznji">Izaberi</button></td>
                                                                        `;
                                    if (vozac == 4)
                                        break;
                            }
                            tabelaVoznji += "</table>";
                            $("#odabirVozaca").html(tabelaVoznji);
                        

                        } else {
                            $("#odabirVozaca").show();

                            $("#odabirVozaca").html("<h4>Nema slobodnih vozaca</h4>");
                        }
                    }
                })
            });

            $(document).on("click", "#dodavanjeVozacaVoznji", function () {
                let vozacId = $(this).val();
                //putom  cu da posaljem id voznje i vozaca i onda ce vozacu da se promeni zauzetost a voznji da se doda vozac i dispecer
                //put da je vozac zauzet
                //get - da dobijes automobil od vozaca
                //put voznju-nadjes sa tim id-jom i stavim joj id vozaca id dispecera i tip auta i status na obradjena

                let vozac = {
                    Zauzet: 1,
                    Ban: 2,
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Vozac/' + vozacId,
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data)
                            alert("Vozac je zauzet sada");
                    }
                })

                let autic;
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + vozacId,
                    async: false,
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        autic = data.Automobil.Tip;
                    }
                })


                let voznja = {
                    idDispecer: korisnikovAJDI,
                    idVozac: vozacId,
                    Id: odabranaVoznja,
                    StatusVoznje: 2,
                    Automobil: autic,
                };
                
                $.ajax({
                    type: 'PUT',
                    url: '/api/Voznja/' + odabranaVoznja,
                    data: JSON.stringify(voznja),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Vasa voznja je formirana :)");
                            $(location).attr('href', 'single.html')
                        }
                    }
                })

            });

            $(document).on("click", "#neuspesnaDugme", function () {
                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {
                    $('#neuspesnaVoznjaKomentarDiv').show(500);

                    id = $(this).val() + ";" + korisnikovAJDI;
                    idVoznje = $(this).val();

                    let voznja = {
                        idVozac: korisnikovAJDI,
                        StatusVoznje: 5,
                    };

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Voznja/' + idVoznje,
                        data: JSON.stringify(voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                let vozac = {
                                    Zauzet: 0,
                                    Ban: 2,
                                };

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Vozac/' + korisnikovAJDI,
                                    data: JSON.stringify(vozac),
                                    contentType: 'application/json; charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        if (data == false) { }
                                        else {
                                            let informacije = "<br />Molim Vas, ostavite komentar<table border='1'>";

                                            informacije += `  <tr>
                                                            <td>Opis</td>
                                                                <td><input type=\"text\" id=\"opis\" required/></td>
                                                        </tr>
                                                         <tr>
                                                            <td>Ocena:</td>
                                                                <td>
                                                                <select name="Ocena" id="ocena">
                                                                    <option>0</option>
                                                                    <option>1</option>
                                                                    <option>2</option>
                                                                    <option>3</option>
                                                                    <option>4</option>
                                                                    <option>5</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                            <tr>
                                                                <td colspan=\"2\"><button id="dodajKomentar">OK</button></td>
                                                        </tr>
                                                            `;
                                            informacije += "</table><br />";
                                            $('#neuspesnaVoznjaKomentarDiv').html(informacije);

                                        }
                                    }
                                })

                            } else {
                                alert("Voznja je vec u stanju neuspesna/uspesna");
                            }
                        }
                    })
                }
            });
            let idVoznjee = '';
            $(document).on("click", "#uspesnaDugme", function () {
                if ($("#iznosU").val() == "" || fulAdresa == '') {
                    alert("Unesite i iznos i odredite adresu!");
                } else {
                    if ($("#opis").val() == "") {
                        alert("Unesite komentar!");
                    } else {
                        idVoznjee = $(this).val();
                        $('#neuspesnaVoznjaKomentarDiv').show(500);
                        id = $(this).val() + ";" + korisnikovAJDI;//ne koristim
                        idVoznje = $(this).val();

                        let voznja = {
                            idVozac: korisnikovAJDI,
                            StatusVoznje: 6,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Voznja/' + idVoznjee,
                            data: JSON.stringify(voznja),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {

                                    let vozac = {
                                        Zauzet: 0,
                                        Ban: 2,
                                    };

                                    $.ajax({
                                        type: 'PUT',
                                        url: '/api/Vozac/' + korisnikovAJDI,
                                        data: JSON.stringify(vozac),
                                        contentType: 'application/json; charset=utf-8',
                                        dataType: 'json',
                                        success: function (data) {
                                            if (data) {
                                                let informacije = "<br />Unesite podatke<table border='1'>";

                                                informacije += `  <tr>
                                                    <td>Iznos</td>
                                                        <td><input type=\"text\" pattern="[0-9]{1,}" id=\"iznosU\" required/></td>
                                                    <tr>
                                                        <td colspan=\"2\"><button id="podaciUspesno">OK</button></td>
                                                </tr>
                                                    `;
                                                informacije += "</table><br />";
                                                $('#neuspesnaVoznjaKomentarDiv').html(informacije);
                                                $("#map1").show(500);


                                            } else {
                                                alert("Neuspesno");
                                            }

                                        }
                                    })


                                } else {
                                    alert("Voznja je vec u stanju neuspesna/uspesna");
                                }
                            }

                        })
                    }
                }
            });


            $(document).on("click", "#podaciUspesno", function () {
               
                let r = document.getElementById("iznosU");
                if (!r.checkValidity()) {
                    alert("Morate uneti iznos!");
                } else {
                    let ime = localStorage.getItem("korisnik");


                    let niz = fulAdresa.split(",");

                    let lokacija = {
                        X: `${niz[0]}`,
                        Y: `${niz[1]}`,
                        Adresa: `${""}`,
                    };

                    let adresa = {
                        UlicaBroj: `${niz[2]}`,
                        NaseljenoMesto: `${niz[3]}`,
                        PozivniBrojMesta: `${''}`,
                    };


                    let voznja = {
                        Iznos: `${$('#iznosU').val()}`,
                    };

                    lokacija.Adresa = adresa;
                    voznja.Odrediste = lokacija; // ovo saljem post metodom i iznos

                    $.ajax({
                        type: 'PUT',
                        url: '/api/Voznja/' + idVoznjee,
                        data: JSON.stringify(voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            alert("Uspesno dodavanje iznosa i odredista");
                            $(location).attr('href', 'single.html');

                        }
                    })
                }

            });

            $(document).on("click", "#prihvatiDugme", function () {
                if ($("#iznosU").val() == "" || fulAdresa=='' ) {
                    alert("Unesite i iznos i odredite adresu!");
                } else {
                    if ($("#opis").val() == "") {
                        alert("Unesite komentar!");
                    } else {
                        idVoznjee = $(this).val();

                        let voki = {};

                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac/' + korisnikovAJDI,
                            async: false,
                            success: function (data) {
                                if (data) {
                                    voki = data;
                                } else {

                                }
                            }
                        })

                        if (voki.Zauzet == 0) {

                            let voznjica = {};
                            $.ajax({
                                type: 'GET',
                                url: '/api/Voznja/' + idVoznjee,
                                async: false,
                                success: function (data) {
                                    if (data) {
                                        voznjica = data;
                                    } else {

                                    }
                                }
                            })
                            let odgovara = true;
                            if (voznjica.Automobil != 0) { //Ako nije svejedno
                                if (voki.Automobil.Tip != voznjica.Automobil) {
                                    alert("Nemate odgovarajuci tip automobila");
                                    odgovara = false;
                                }
                            }

                            if (odgovara) {
                                let voznja = {
                                    idVozac: korisnikovAJDI,
                                    StatusVoznje: 3,
                                };

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Voznja/' + idVoznjee,
                                    data: JSON.stringify(voznja),
                                    contentType: 'application/json; charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        if (data) {
                                        } else {

                                        }
                                    }
                                })

                                let vozac = {
                                    Zauzet: 1,
                                    Ban: 2,
                                };

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Vozac/' + korisnikovAJDI,
                                    data: JSON.stringify(vozac),
                                    contentType: 'application/json; charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        if (data) {
                                            alert("Uspesno prihvatanje voznje");
                                            $(location).attr('href', 'single.html');

                                        }
                                    }
                                })
                            }
                        } else {
                            alert("Prvo zavrsite sa svojom voznjom (uspesna/neuspesna)");
                        }
                    }
                }
            });
            
            $(document).on("click", "#korisnikDodajKomentar", function () {
                
                idVoznje = $(this).val();
                $('#izmenaPojedinacneVoznjeDiv').show();
                let informacije = "<br />Molim Vas, ostavite komentar<table border='1'>";
                // Tabela ima objekat voznja + tip auta da se izabere
                informacije += `  <tr>
                                                    <td>Opis</td>
                                                        <td><input type=\"text\" id=\"opis\" required/></td>
                                                </tr>


                                                 <tr>
                                                    <td>Ocena:</td>
                                                        <td>
                                                        <select name="Ocena" id="ocena">
                                                            <option>0</option>
                                                            <option>1</option>
                                                            <option>2</option>
                                                            <option>3</option>
                                                            <option>4</option>
                                                            <option>5</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                    <tr>
                                                        <td colspan=\"2\"><button id="dodajKomentar">OK</button></td>
                                                </tr>
                                                    `;
                informacije += "</table><br />";
                $('#izmenaPojedinacneVoznjeDiv').html(informacije);






            });

            var filter;
            var konst;
            $("#fitriranjeVoznji").click(function () {

                if ($("#opis").val() == "") {
                    alert("Unesite komentar!");
                } else {
                    var sadrzaj = $("#izmeni").text();
                    if (sadrzaj == "Promeni informacije") {
                        fleg = [];
                        pretragica = false;
                        $("#voznjeNaCekanjuVozac").hide();

                        $("#filtriranje").show();
                        $("#korisnik").css("display", "none");
                        $("#vozac").css("display", "none");

                        $("#dispecer").css("display", "none");
                        $("#map1").hide();
                        $('#profil').hide();
                        $("#block").hide();
                        $('#formiranjeVoznjeDispecer').hide();
                        $('#obradaVoznjeDispecer').hide();
                        $('#odabirVozaca').hide();
                        $('#dodavanjeKorisnikaDiv').hide();
                        $('#dugmeDodajVozaca').hide();

                        $("#pocetna").hide();
                        $("#pocetna1").hide();
                        $("#naruciVoznjuDiv").hide();
                        $("#dugmeNaruciVoznjuDiv").hide();
                        $("#dugmeIzmeni").hide();
                        $("#promeniLokacijuDiv").hide();
                        $('#profil').hide();

                        filter = "<h2 style=\"color:#1abc9c; \" align=\"center\" >Pretraži svoje vožnje</h2><hr /><ul align=\"left\">";

                        filter += "<button id=\"reset\" class=\"dugmeSrc\">Reset</button><li><h3>Pretrazi po: ";
                        filter += `<p style=\"margin-left:304px; font-size:24px\"><b>Datumu:</b> &emsp; od : <input type=\"date\"  id=\"odDate\"> do: <input type=\"date\"  id=\"doDate\"></p><br />
                           <p style=\"margin-left:304px; font-size:24px\"> <b>Oceni:</b> &emsp; od : <input type=\"number\" min=\"0\" max=\"5\" style=\"width:40px\" id=\"odOcena\"> do: <input type=\"number\" min=\"0\" max=\"5\" style=\"width:40px\"  id=\"doOcena\"></p><br />
                           <p style=\"margin-left:304px; font-size:24px\"> <b>Ceni:</b>&emsp;od : <input type=\"number\" min=\"0\" style=\"width:90px\" id=\"odCena\"> do: <input type=\"number\" min=\"0\"  style=\"width:90px\"  id=\"doCena\"></p><button class=\"dugmeSrc\" style=\"margin-left:971px;\" id=\"pretraziPo\">Pretrazi</button>
                            <hr />`;
                        filter += "<li><h3>Odaberi status voznje po kom zelis da filtriras: ";
                        filter += `<select id="stanje">
                            <option disabled selected>Odaberi stanje</option>
                            <option value=0>Kreirana</option>
                            <option value=1>Formirana</option>
                            <option value=2>Obradjena</option>
                            <option value=3>Prihvacena</option>
                            <option value=4>Otkazana</option>
                            <option value=5>Neuspesna</option>
                            <option value=6>Uspesna</option>
                                    </select > `;
                        filter += "<button id=\"filterPoStanju\" class=\"dugmeSrc\" style=\"margin-left:71px;\">Filtriraj</button></h3></li><hr />";

                        filter += "<li><h3>Odaberi polje po kojem zelis da sortiras: ";
                        filter += `<select id="polje">
                            <option disabled selected>Polje</option>
                            <option value=0>Datum</option>
                            <option value=1>Ocena</option>
                                    </select > `;
                        filter += "<button id=\"sortPo\" class=\"dugmeSrc\" style=\"margin-left:61px;\">Sortiraj</button></h3></li></ul><hr />";

                        if (uloga == 1) {


                            filter += `<ul align=\"left\"><li> <h3>Odaberi tip korisnika: <select id="tipKorisnika">
                                        <option disabled selected>Tip korisnika</option>
                                        <option value=0 > Vozac</option>
                            <option value=1 > Musterija</option>
                                    </select > &emsp;Ime: <input type=\"text\" style=\"width:200px\" id=\"imePolje\"> &emsp;Prezime: <input type=\"text\" style=\"width:200px\"  id=\"prezimePolje\">       <button style=\"margin-left:20px;\" class=\"dugmeSrc\" id=\"pretraziPoDisp\">Pretrazi</button></h3></li></ul> `;

                        } else if (uloga == 2) {
                            filter += `<ul align=\"left\"><li><button style=\"margin-left:20px;\" class=\"dugmeSrc\" id=\"sortirajPoUdaljenosti\">Sortiraj po udaljenosti</button></h3></li></ul> `;

                        }

                        konst = filter;


                        $("#filtriranje").html(filter);
                        // tabelaPrikaza
                    } else {
                        alert("Niste sacuvali izmene.");
                        $("#izmeni").css("background-color", "#ff4d4d");

                    }
                }

            });
            let fleg = [];
            let pretragica = false;

            var opcija;
            $(document).on("click", "#reset", function () {
                pretragica = false;
                fleg = [];
                $("#tabelaPrikaza").html('');
            });
            
            $(document).on("click", "#sortirajPoUdaljenosti", function () {
                let vozacevaLokacija;
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac/' + korisnikovAJDI,
                    async: false,
                    success: function (data) {
                        vozacevaLokacija = data.Lokacija;
                    }
                })
                let voznjeVozaca;
                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja',
                        async: false,
                        success: function (data) {
                            if (pretragica)
                                data = fleg;
                            voznjeVozaca = [];
                            for (var voznja in data) {
                                if (data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje==0) {
                                    voznjeVozaca.push(data[voznja]);//ovde su sve vozaceve voznje
                                }
                            }
                        }
                })

                let sortiraj = [];
                
                for (var voznja in voznjeVozaca) {
                        // c = √ ((xA − xB) ² + (yA − yB) ² )
                    let rastojanje;
                    rastojanje = Math.sqrt(Math.pow(vozacevaLokacija.X - voznjeVozaca[voznja].Lokacija.X, 2) + Math.pow(vozacevaLokacija.Y - voznjeVozaca[voznja].Lokacija.Y, 2));

                        let voznje1 = {
                            Id: voznjeVozaca[voznja].Id,//id voznje
                            Rastojanje: rastojanje,//od vozaca
                        }
                    sortiraj.push(voznje1);
                    }
             

                sortiraj.sort(function (a, b) {
                    return a.Rastojanje - b.Rastojanje;
                })
                let temp = [];
                for (var voznja in sortiraj) {
                    for (var voznje in voznjeVozaca) {
                        if (sortiraj[voznja].Id == voznjeVozaca[voznje].Id)
                            temp.push(voznjeVozaca[voznje]);
                    }
                }
                fleg = temp;
                pretragica = true;
                let tabelaVoznji = `<table border='1'><tr><th>Id voznje</th><th>Musterija</th><th>Vozac</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                tabelaVoznji += "<th>Komentar</th>";
                tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
               

                for (var voznja in temp) {
                    var currentdate = new Date(Date.parse(temp[voznja].DatumVreme));
                    var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);
                    var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                    tabelaVoznji += `<tr><td>${temp[voznja].Id}</td>`;
                    if (temp[voznja].idKorisnik != " ") {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Korisnik/' + temp[voznja].idKorisnik,
                            async: false,
                            success: function (data) {
                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                            }
                        })
                    } else {
                        tabelaVoznji += `<td> </td>`;
                    }
                    if (temp[voznja].idVozac != " ") {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac/' + temp[voznja].idVozac,
                            async: false,
                            success: function (data) {
                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                            }
                        })
                    } else {
                        tabelaVoznji += `<td> </td>`;
                    }
                    tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${temp[voznja].Lokacija.Adresa.UlicaBroj},${temp[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;
                    
                    if (temp[voznja].Iznos != "0") {
                        tabelaVoznji += `<td>${temp[voznja].Odrediste.Adresa.UlicaBroj},${temp[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${temp[voznja].Iznos}</td>`;
                    } else {
                        tabelaVoznji += `<td></td><td></td>`;
                    }

                    if (temp[voznja].Komentar.Ocena == "1" || temp[voznja].Komentar.Ocena == "2" || temp[voznja].Komentar.Ocena == "3" || temp[voznja].Komentar.Ocena == "4" || temp[voznja].Komentar.Ocena == "5") {
                        tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${temp[voznja].Komentar.idKorisnik}\nTekst:${temp[voznja].Komentar.Opis}\nOcena:${temp[voznja].Komentar.Ocena}\nDatum:${temp[voznja].Komentar.DatumObjave}</textarea></td>`;

                    } else {
                        tabelaVoznji += `<td> </td>`;
                    }
                    tabelaVoznji += `<td>${getEnumTipAutomobila(temp[voznja].Automobil)}</td><td>${getEnumStatus(temp[voznja].StatusVoznje)}</td></tr>`;
                }
          
        tabelaVoznji += "</table>";
        $("#tabelaPrikaza").html(tabelaVoznji);
                
            });


            $(document).on("click", "#filterPoStanju", function () {

                let stanje = $("#stanje").val();
                if (stanje == null) { //ako je sve null morate odabrati
                    alert("Morate odabrati filter :)");
                } else {
                    $("#odDate").val('');
                    $("#doDate").val('');
                    $("#odOcena").val('');
                    $("#doOcena").val('');
                    $("#odCena").val('');
                    $("#doCena").val('');
                    $("#tabelaPrikaza").show();

                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja',
                        async:false,
                        success: function (data) {
                            if (pretragica)
                                data = fleg;
                            else
                                fleg = [];
                            
                           
                            let ima = 0;
                            for (var voznja in data) {
                                if (uloga == 0) {
                                    if (data[voznja].idKorisnik == korisnikovAJDI && data[voznja].StatusVoznje == stanje)
                                        ima = 1;
                                } else if (uloga == 1) {
                                    if (data[voznja].StatusVoznje == stanje)
                                        ima = 1;
                                } else if (uloga == 2) {
                                    if ((data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0) && data[voznja].StatusVoznje == stanje)
                                        ima = 1;
                                }
                            }

                            if (data.length == 0 || ima == 0) {
                                let st = `<h4 align=\"center\">Ne postoji voznja sa statusom "` + getEnumStatus(parseInt(stanje)) + `" u sistemu</h4>`;
                                $("#tabelaPrikaza").html(st);
                            } else {
                                let tabelaVoznji = `<table border='1'><tr><th>Id voznje</th><th>Musterija</th><th>Vozac</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                tabelaVoznji += "<th>Komentar</th>";
                                tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                                let vs = [];
                                for (var voznja in data) {
                                    if (uloga == 0) {
                                        if (data[voznja].idKorisnik == korisnikovAJDI && data[voznja].StatusVoznje == stanje) {//korisnikov ajdi mi je i kod vozaca njegov i kod svakog..
                                            vs.push(data[voznja]);
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                            var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);
                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;
                                            
                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Vozac/' + data[voznja].idVozac,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                            tabelaVoznji+=`<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;

                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                        }
                                    }
                                    else if (uloga == 1) {
                                        if (data[voznja].StatusVoznje == stanje) {//korisnikov ajdi mi je i kod vozaca njegov i kod svakog..
                                            vs.push(data[voznja]);
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;

                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                        }
                                    } else if (uloga == 2) {//vozac ima svoje i sve kreirane
                                        if ((data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0) && data[voznja].StatusVoznje == stanje) {//korisnikov ajdi mi je i kod vozaca njegov i kod svakog..
                                            vs.push(data[voznja]);

                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                            var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;


                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;

                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                        }
                                    }
                                }

                                tabelaVoznji += "</table>";
                                $("#tabelaPrikaza").html(tabelaVoznji);
                                fleg = vs;

                            }
                        }
                    })
                }
                $("#stanje").val('Odaberi stanje');
                pretragica = true;
            });



            $(document).on("click", "#sortPo", function () {
                let polje = $("#polje").val();
                alert($("#polje").val());
                if (polje == null) {
                    alert("Morate odabrati sort :)");
                } else {
                    //restuj cenu ocenu i datum u pretrazi na prazno
                    $("#odDate").val('');
                    $("#doDate").val('');
                    $("#odOcena").val('');
                    $("#doOcena").val('');
                    $("#odCena").val('');
                    $("#doCena").val('');

                    $("#tabelaPrikaza").show();
                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja',
                        async: false,
                        success: function (data) {
                            if (pretragica)
                                data = fleg;
                            else
                                fleg = [];

                            if (polje == 1) {//po oceni
                                for (var voznja in data) {
                                    if (data[voznja].Komentar.Ocena == " ")
                                        data[voznja].Komentar.Ocena = "-1";
                                }
                                data.sort(function (a, b) {
                                    return b.Komentar.Ocena - a.Komentar.Ocena;
                                })
                                for (var voznja in data) {
                                    if (data[voznja].Komentar.Ocena == "-1")
                                        data[voznja].Komentar.Ocena = " ";
                                }

                            } else if (polje == 0) {//po datumu
                                data.sort(function (a, b) {
                                    return new Date(b.DatumVreme) - new Date(a.DatumVreme);
                                })
                            }
                            
                            let ima = 0;
                            for (var voznja in data) {
                                if (uloga == 0) {
                                    if (data[voznja].idKorisnik == korisnikovAJDI)
                                        ima = 1;
                                } else if (uloga == 1) {
                                    ima = 1;
                                } else if (uloga == 2) {
                                    if (data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0)
                                        ima = 1;
                                }
                            }

                            if (data.length == 0 || ima == 0) {
                                let st = `<h4 align=\"center\">Ne postoji voznja sa statusom "` + getEnumStatus(parseInt(stanje)) + `" u sistemu</h4>`;
                                $("#tabelaPrikaza").html(st);

                            } else {
                                let tabelaVoznji = `<table border='1'><tr><th>Id voznje</th><th>Musterija</th><th>Vozac</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                tabelaVoznji += "<th>Komentar</th>";
                                tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                                let vs = [];
                                for (var voznja in data) {
                                    if (uloga == 0) {
                                        if (data[voznja].idKorisnik == korisnikovAJDI) {//ovde isto vazi i za vozaca i dispecera
                                            vs.push(data[voznja]);
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;
                                            
                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                        }
                                    } else if (uloga == 1) {//dispecer ima sve voznje
                                        vs.push(data[voznja]);
                                        var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                        var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                        var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                        tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                        if (data[voznja].idKorisnik != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                            })
                                        } else {
                                            tabelaVoznji += `<td> </td>`;
                                        }

                                        if (data[voznja].idVozac != " ") {
                                            $.ajax({
                                                type: 'GET',
                                                url: '/api/Vozac/' + data[voznja].idVozac,
                                                async: false,
                                                success: function (data) {
                                                    tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                }
                                            })
                                        } else {
                                            tabelaVoznji += `<td> </td>`;
                                        }

                                        tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                        if (data[voznja].Iznos != "0") {
                                            tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                        } else {
                                            tabelaVoznji += `<td></td><td></td>`;
                                        }

                                        if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                            tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                        } else {
                                            tabelaVoznji += `<td> </td>`;
                                        }
                                        tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;

                                    } else if (uloga == 2) {//vozac ima svoje voznje i slobodne
                                        if (data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0) {//ovde isto vazi i za vozaca i dispecera
                                            vs.push(data[voznja]);

                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));

                                            var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;
                                            
                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                        }
                                    }
                                }
                                tabelaVoznji += "</table>";
                                $("#tabelaPrikaza").html(tabelaVoznji);
                                fleg = vs;
                            }
                        }
                    })
                }
                $("#polje").val('Polje');
                pretragica = true;

            });

            $(document).on("click", "#pretraziPo", function () {
                let oddejt;
                let dodejt;
                let D = false;
                let O = false;
                let C = false;
                oddejt = document.getElementById("odDate").value;
                dodejt = document.getElementById("doDate").value;
                let od = parseInt($("#odDate").val());
                let doo = parseInt($("#doDate").val());
                let odDatum = $("#odDate").val();
                let doDatum = $("#doDate").val();
                let odOcena = $("#odOcena").val();
                let doOcena = $("#doOcena").val();
                let odCena = $("#odCena").val();
                let doCena = $("#doCena").val();

                if (odDatum != "" && doDatum != "") D = true;
                if (odOcena != "" && doOcena != "") O = true;
                if (odCena != "" && doCena != "") C = true;

                if (odDatum == "" && doDatum != "") {
                    oddejt = "2000-03-03";
                    D = true;
                } else if (odDatum != "" && doDatum == "") {
                    dodejt = "2019-03-03";
                    D = true;
                }

                if (odOcena == "" && doOcena != "") {
                    odOcena = "0";
                    O = true;
                } else if (odOcena != "" && doOcena == "") {
                    O = true;
                    doOcena = "5";
                }


                if (odCena == "" && doCena != "") {
                    odCena = "0";
                    C = true;
                } else if (odCena != "" && doCena == "") {
                    C = true;
                    doCena = "90000";
                }

                if (odDatum == "" && doDatum == "" && doOcena == "" && odOcena == "" && doCena == "" && odCena == "") {
                    alert("Morate uneti bar neki kriterijum");
                } else {
                    $("#tabelaPrikaza").show();
                    //get sve voznje
                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja',
                        async:false,
                        success: function (data) {
                            if (pretragica)
                                data = fleg;
                            else
                                fleg = [];
                            let ima = 0;
                            for (var voznja in data) {
                                if (uloga == 0) {
                                    if (data[voznja].idKorisnik == korisnikovAJDI)
                                        ima = 1;
                                }
                                else if (uloga == 1) {
                                    ima = 1;
                                }
                                else if (uloga == 2) {
                                    if (data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0)
                                        ima = 1;
                                }
                            }
                            if (data.length == 0 || ima == 0) {
                                let st = `<h4 align=\"center\">Nema voznja u sistemu</h4>`;

                                $("#tabelaPrikaza").html(st);

                            } else {
                                let data1 = [];

                                for (var voznja in data) {
                                    if (data[voznja].Komentar.Ocena == " ")
                                        data[voznja].Komentar.Ocena = "-1";
                                }

                                let datumi = [];
                                //u DATA JE SVE i kopiram u datumi
                                if (D) //trazim po datumu
                                {
                                    for (var voznja in data) {
                                        if (new Date((data[voznja].DatumVreme).substring(0, 10)) >= new Date(oddejt) && new Date((data[voznja].DatumVreme).substring(0, 10)) <= new Date(dodejt))
                                            datumi.push(data[voznja]);
                                    }
                                } else {
                                    datumi = data;
                                }

                                let ocene = [];

                                if (O) //trazim po oceni
                                {
                                    for (var voznja in datumi) {
                                        if (parseInt(data[voznja].Komentar.Ocena) >= odOcena && parseInt(data[voznja].Komentar.Ocena) <= doOcena && parseInt(data[voznja].Ocena) != -1)
                                            ocene.push(data[voznja]);
                                    }
                                } else {
                                    ocene = datumi;
                                }


                                let cene = [];
                                if (C) //trazim po ceni
                                {
                                    for (var voznja in ocene) {
                                        if (parseInt(data[voznja].Iznos) > odCena && parseInt(data[voznja].Iznos) <= doCena)
                                            cene.push(data[voznja]);
                                    }
                                } else {
                                    cene = ocene;
                                }

                                data = cene;

                                for (var voznja in data) {
                                    if (data[voznja].Komentar.Ocena == "-1")
                                        data[voznja].Komentar.Ocena = " ";
                                }

                                if (data.length == 0) {
                                    let st = `<h4 align=\"center\">Nema voznji sa tim kriterijumom</h4>`;
                                    $("#tabelaPrikaza").html(st);
                                } else {
                                    let tabelaVoznji = `<table border='1'><tr><th>Id voznje</th><th>Musterija</th><th>Vozac</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                                    tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                                    tabelaVoznji += "<th>Komentar</th>";
                                    tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                                    let vs = [];
                                    for (var voznja in data) {//ako je voznja sa tim id-jem korisnika ako je uloga 0
                                        if (uloga == 0) {
                                            if (data[voznja].idKorisnik == korisnikovAJDI) {//ovde istp korisnikov ajdi
                                                vs.push(data[voznja]);
                                                var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                                var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                                var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                                tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                                if (data[voznja].idKorisnik != " ") {
                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td> </td>`;
                                                }

                                                if (data[voznja].idVozac != " ") {
                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Vozac/' + data[voznja].idVozac,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td> </td>`;
                                                }
                                                tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                                if (data[voznja].Iznos != "0") {
                                                    tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                                } else {
                                                    tabelaVoznji += `<td></td><td></td>`;
                                                }

                                                if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                    tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                                } else {
                                                    tabelaVoznji += `<td> </td>`;

                                                }
                                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                            }
                                        }
                                        else if (uloga == 1) {
                                            vs.push(data[voznja]);
                                            var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                            var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                            var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                            tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                            if (data[voznja].idKorisnik != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            if (data[voznja].idVozac != " ") {
                                                $.ajax({
                                                    type: 'GET',
                                                    url: '/api/Vozac/' + data[voznja].idVozac,
                                                    async: false,
                                                    success: function (data) {
                                                        tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                    }
                                                })
                                            } else {
                                                tabelaVoznji += `<td> </td>`;
                                            }

                                            tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                            if (data[voznja].Iznos != "0") {
                                                tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                            } else {
                                                tabelaVoznji += `<td></td><td></td>`;
                                            }

                                            if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                            } else {
                                                tabelaVoznji += `<td> </td>`;

                                            }
                                            tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;

                                        }
                                        else if (uloga == 2) {
                                            if (data[voznja].idVozac == korisnikovAJDI || data[voznja].StatusVoznje == 0) {//ovde istp korisnikov ajdi
                                                vs.push(data[voznja]);

                                                var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                                var datum = currentdate.getUTCFullYear() + "/" + ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" + ("0" + currentdate.getUTCDate()).slice(-2);

                                                var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" + ("0" + currentdate.getUTCMinutes()).slice(-2);
                                                tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;


                                                if (data[voznja].idKorisnik != " ") {
                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td> </td>`;
                                                }

                                                if (data[voznja].idVozac != " ") {
                                                    $.ajax({
                                                        type: 'GET',
                                                        url: '/api/Vozac/' + data[voznja].idVozac,
                                                        async: false,
                                                        success: function (data) {
                                                            tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                                        }
                                                    })
                                                } else {
                                                    tabelaVoznji += `<td> </td>`;
                                                }

                                                tabelaVoznji += `<td>${datum} u ${vreme}h</td><td>${data[voznja].Lokacija.Adresa.UlicaBroj},${data[voznja].Lokacija.Adresa.NaseljenoMesto}</td>`;


                                                if (data[voznja].Iznos != "0") {
                                                    tabelaVoznji += `<td>${data[voznja].Odrediste.Adresa.UlicaBroj},${data[voznja].Odrediste.Adresa.NaseljenoMesto}</td><td>${data[voznja].Iznos}</td>`;
                                                } else {
                                                    tabelaVoznji += `<td></td><td></td>`;
                                                }

                                                if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                                    tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                                } else {
                                                    tabelaVoznji += `<td> </td>`;

                                                }
                                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td><td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>`;
                                            }
                                        }

                                    }
                                    fleg = vs;
                                    tabelaVoznji += "</table>";
                                    $("#tabelaPrikaza").html(tabelaVoznji);
                                    //ovde u local storidz
                                }

                            }

                        }

                    })
                }

                $("#odDate").val('');
                $("#doDate").val('');
                $("#odOcena").val('');
                $("#doOcena").val('');
                $("#odCena").val('');
                $("#doCena").val('');
                pretragica = true;

            });

            $(document).on("change", "#tipKorisnika", function () {
                $("#imePolje").val('');
                $("#prezimePolje").val('');
            });

            $(document).on("click", "#pretraziPoDisp", function () {
                //$("#tabelaPretraga").html('');
                let opcija = $("#tipKorisnika").val();
                if (opcija == null) {
                    alert("Niste izabrali tip korisnika");
                } else {
                    let kriterijum;
                    let imePolje = $("#imePolje").val();
                    let przPolje = $("#prezimePolje").val();

                    if (imePolje == "" && przPolje == "") {
                        alert("Morate uneti bar jedan kriterijum pretrage");
                    } else {
                        if (imePolje == "" && przPolje != "") {
                            kriterijum = 1;
                        } else if (imePolje != "" && przPolje == "") {
                            kriterijum = 0;
                        } else if (imePolje != "" && przPolje != "") {
                            kriterijum = 2;
                        }

                        let podaci = [];
                        let zadovoljavaju = [];
                        let voznje = [];

                        if (opcija == 1) {
                            $.ajax({
                                type: 'GET',
                                url: '/api/Korisnik',
                                async: false,
                                success: function (data) {
                                    podaci = data;

                                }
                            })
                        } else if (opcija == 0) {
                            $.ajax({
                                type: 'GET',
                                async: false,
                                url: '/api/Vozac',
                                success: function (data) {
                                    podaci = data;

                                }
                            })
                        }


                        $.ajax({
                            type: 'GET',
                            url: '/api/Voznja',
                            async: false,
                            success: function (data) {
                                voznje = data;

                            }
                        })


                        //prodjes kors korisnike i ispises u neku listu svi koji zadovoljavaju
                        for (var k in podaci) {
                            if (kriterijum == 0) // samo po imennu
                            {
                                if ((podaci[k].Ime).toLowerCase().includes(imePolje.toLowerCase()))
                                    zadovoljavaju.push(podaci[k]);

                            } else if (kriterijum == 1)//samo po prezimenu
                            {
                                if ((podaci[k].Prezime).toLowerCase().includes(przPolje.toLowerCase()))
                                    zadovoljavaju.push(podaci[k]);


                            } else if (kriterijum == 2)//po imenu i prezimenu
                            {
                                if ((podaci[k].Prezime).toLowerCase().includes(przPolje.toLowerCase()) && (podaci[k].Ime).toLowerCase().includes(imePolje.toLowerCase()))
                                    zadovoljavaju.push(podaci[k]);


                            }
                        }
                        let konacno = [];
                        if (opcija == 0) {//vozaci
                            if (pretragica)
                                voznje = fleg;
                            else
                                fleg = [];
                            for (var voznja in voznje) {

                                for (var vozac in zadovoljavaju) {
                                    if (voznje[voznja].idVozac == zadovoljavaju[vozac].Id)
                                        konacno.push(voznje[voznja]);
                                }

                            }

                        } else if (opcija == 1) {//korisnici
                            if (pretragica)
                                voznje = fleg;
                            else
                                fleg = [];
                            for (var voznja in voznje) {
                                for (var musterija in zadovoljavaju) {
                                    if (voznje[voznja].idKorisnik == zadovoljavaju[musterija].Id)
                                        konacno.push(voznje[voznja]);
                                }
                            }
                        }

                        if (konacno.length == 0) {
                            $("#tabelaPrikaza").html(`<h4 align=\"center\">Nema rezultata pretrage</h4>`);

                        } else {
                            data = konacno;
                            let tabelaVoznji = `<h3 margin-left:200px>Rezultati</h3><hr /><table border='1'><tr><th>Id voznje</th><th>Musterija</th><th>Vozac</th><th  width="200px">Datum i vreme</th><th width="300px">Lokacija</th>`;
                            tabelaVoznji += "<th>Odrediste</td><th>Iznos</th>";
                            tabelaVoznji += "<th>Komentar</th>";
                            tabelaVoznji += "<th>Tip automobila</th> <th>Status voznje</th></tr>";
                            for (var voznja in data) {
                                fleg = data;
                                var currentdate = new Date(Date.parse(data[voznja].DatumVreme));
                                var datum =
                                    currentdate.getUTCFullYear() + "/" +
                                    ("0" + (currentdate.getUTCMonth() + 1)).slice(-2) + "/" +
                                    ("0" + currentdate.getUTCDate()).slice(-2);

                                var vreme = ("0" + currentdate.getUTCHours()).slice(-2) + ":" +
                                    ("0" + currentdate.getUTCMinutes()).slice(-2);
                                
                                tabelaVoznji += `<tr><td>${data[voznja].Id}</td>`;

                                if (opcija == 1) {
                                    if (data[voznja].idKorisnik != " ") {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                            async: false,
                                            success: function (data) {
                                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                            }
                                        })
                                    } else {
                                        tabelaVoznji += `<td> </td>`;
                                    }

                                    if (data[voznja].idVozac != " ") {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Vozac/' + data[voznja].idVozac,
                                            async: false,
                                            success: function (data) {
                                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                            }
                                        })
                                    } else {
                                        tabelaVoznji += `<td> </td>`;
                                    }

                                } else {

                                    if (data[voznja].idKorisnik != " ") {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Korisnik/' + data[voznja].idKorisnik,
                                            async: false,
                                            success: function (data) {
                                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                            }
                                        })
                                    } else {
                                        tabelaVoznji += `<td> </td>`;
                                    }

                                    if (data[voznja].idVozac != " ") {
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Vozac/' + data[voznja].idVozac,
                                            async: false,
                                            success: function (data) {
                                                tabelaVoznji += `<td>${data.Ime} ${data.Prezime}</td>`;
                                            }
                                        })
                                    } else {
                                        tabelaVoznji += `<td> </td>`;
                                    }
                                }

                                tabelaVoznji += `
                                                                        <td>${datum} u ${vreme}h</td>
                                                                        <td>

                                                                        ${data[voznja].Lokacija.Adresa.UlicaBroj},
                                                                       ${data[voznja].Lokacija.Adresa.NaseljenoMesto}
                                                                       </td>`;


                                if (data[voznja].Iznos != "0") {
                                    tabelaVoznji += `<td>

                                                                        ${data[voznja].Odrediste.Adresa.UlicaBroj},
                                                                       ${data[voznja].Odrediste.Adresa.NaseljenoMesto}
                                                                            </td>
                                                                            <td>${data[voznja].Iznos}</td>`;
                                } else {
                                    tabelaVoznji += `<td></td>
                                                                            <td></td>`;
                                }

                                if (data[voznja].Komentar.Ocena == "1" || data[voznja].Komentar.Ocena == "2" || data[voznja].Komentar.Ocena == "3" || data[voznja].Komentar.Ocena == "4" || data[voznja].Komentar.Ocena == "5") {
                                    tabelaVoznji += `<td><textarea rows="4" cols="30" disabled>Korisnicko ime:${data[voznja].Komentar.idKorisnik}\nTekst:${data[voznja].Komentar.Opis}\nOcena:${data[voznja].Komentar.Ocena}\nDatum:${data[voznja].Komentar.DatumObjave}</textarea></td>`;

                                } else {
                                    tabelaVoznji += `<td> </td>`;

                                }
                                tabelaVoznji += `<td>${getEnumTipAutomobila(data[voznja].Automobil)}</td>
                                                                        <td>${getEnumStatus(data[voznja].StatusVoznje)}</td></tr>
                                                                        `;

                            }
                            tabelaVoznji += "</table>";
                            $("#tabelaPrikaza").html(tabelaVoznji);



                        }
                    }
                }
                $("#imePolje").val('');
                $("#przPolje").val('');
                //ovde lokal storidz
                pretragica = true;
            });

            $("#broj").click(function () {
                confirm("Pozivanje broja 0643093116...");
            });

            $("#brojHome").click(function () {
                confirm("Pozivanje broja 0358470027...");
            });

            $("#blokiranje").click(function () {

                var sadrzaj = $("#izmeni").text();
                if (sadrzaj == "Promeni informacije") {

                    $("#pocetna").hide();
                    $("#tabelaPretraga").hide();

                    $("#filtriranje").hide();
                    $("#tabelaPrikaz").hide();

                    $("#pocetna1").hide();
                    $("#map1").hide();
                    $("#dugmeIzmeni").hide();
                    $('#profil').hide();
                    $('#formiranjeVoznjeDispecer').hide();
                    $('#obradaVoznjeDispecer').hide();
                    $('#odabirVozaca').hide();
                    $('#pretraga').hide();
                    $('#dodavanjeKorisnikaDiv').hide();
                    $('#dugmeDodajVozaca').hide();
                    $("#dispecer").css("display", "none");
                    $("#block").show();



                    //uzecu sve vozace i sve korisnike i staviti ih u tabelu i imacu dugme ban i unban
                    let korisnici = [];
                    let vozaci = [];

                    $.ajax({
                        type: 'GET',
                        url: '/api/Korisnik',
                        async: false,
                        success: function (data) {
                            korisnici = data;

                        }
                    })


                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac',
                        async: false,
                        success: function (data) {
                            vozaci = data;
                        }
                    })


                    let tabelaKorisnika = `<h2 align=\"center\" style=\"color:#1abc9c\" >Banovanje</h2><hr /><table style=\"margin-left:700px\" class="izmenaTejbl" border='1'><tr><th>Ime</th><th  width="200px">Prezime</th><th width="200px">Tip korisnika</th><th></th></tr>`;

                    for (var kor in korisnici) {
                        tabelaKorisnika += `<tr><td>${korisnici[kor].Ime}</td><td>${korisnici[kor].Prezime}</td><td>Musterija</td>`;
                        if (korisnici[kor].Ban == 0) {
                            tabelaKorisnika += `<td><button id="banK" value=${korisnici[kor].Id}>Ban</button></td></tr>`;
                        } else {
                            tabelaKorisnika += `<td><button id="unbanK" value=${korisnici[kor].Id}>Unban</button></td></tr>`;
                        }
                    }
                    for (var voz in vozaci) {
                        tabelaKorisnika += `<tr><td>${vozaci[voz].Ime}</td><td>${vozaci[voz].Prezime}</td><td>Vozac</td>`;
                        if (vozaci[voz].Ban == 0) {
                            tabelaKorisnika += `<td><button id="banV" value=${vozaci[voz].Id}>Ban</button></td></tr>`;
                        } else {
                            tabelaKorisnika += `<td><button id="unbanV" value=${vozaci[voz].Id}>Unban</button></td></tr>`;
                        }
                    }

                    $("#block").html(tabelaKorisnika);

                } else {
                    alert("Niste sacuvali izmene.");
                    $("#izmeni").css("background-color", "#ff4d4d");
                }


            });

            $(document).on("click", "#banV", function () {
                alert($(this).val());
                let vozac = {
                    Zauzet: 2,
                    Ban: 1,
                };
                $.ajax({
                    type: 'PUT',
                    url: '/api/Vozac/' + $(this).val(),
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno banovan");
                            $(location).attr('href', 'single.html');

                        }
                    }
                })
            });


            $(document).on("click", "#unbanV", function () {
                let vozac = {
                    Zauzet: 2,
                    Ban: 0,
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Vozac/' + $(this).val(),
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno banovan");
                            $(location).attr('href', 'single.html');

                        }
                    }
                })
            });


            $(document).on("click", "#banK", function () {
                alert($(this).val());
                let musterija = {
                    Ban: 1,
                };
                $.ajax({
                    type: 'PUT',
                    url: '/api/Musterija/' + $(this).val(),
                    data: JSON.stringify(musterija),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno banovan");
                            $(location).attr('href', 'single.html');

                        }
                    }
                })
            });


            $(document).on("click", "#unbanK", function () {
                let musterija = {
                    Ban: 0,
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Musterija/' + $(this).val(),
                    data: JSON.stringify(musterija),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert("Uspesno unbanovan");
                            $(location).attr('href', 'single.html');

                        }
                    }
                })
            });




        });





    </script>
</head>
<body>

    <nav class="navbar navbar-default" id="naki">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" id="korisnikProfil" href="#"><p id="wel"></p></a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li><a id="pocetnaStranica" href="#">POCETNA</a></li>
                    <li><button class="navbar-toggle, dropbtn" id="dispecerPretraga"><i class="fa fa-search" style="font-size:20px"></i></button></li>
                    <li><a id="dodajVozaca" href="#">DODAJ VOZACA</a></li>
                    <li>
                        <div class="dropdown">
                            <button class="navbar-toggle, dropbtn">
                                <i class="fas fa-car" id="maja" style="font-size:20px"></i>
                            </button>

                            <div class="dropdown-content">
                                <a id="formirajVoznju" href="#">FORMIRAJ VOZNJU</a>
                                <a id="obradiVoznju" href="#">OBRADI VOZNJU</a>
                            </div>
                        </div>
                    </li>
                    <li><a id="naruciVoznju" href="#">NARUCI VOZNJU</a></li>
                    <li><button class="navbar-toggle, dropbtn" id="fitriranjeVoznji"><i class="fa fa-search" style="font-size:20px"></i></button></li>
                    <li><a id="promeniLokaciju" href="#">PROMENI LOKACIJU I AUTO</a></li>
                    <li><button class="navbar-toggle, dropbtn" id="blokiranje"><i class="fa fa-ban" style="font-size:20px"></i></button></li>
                    <li><a id="odlogovanje" href="#">ODJAVI SE</a></li>

                </ul>
            </div>
        </div>
    </nav>

    <div id="filtriranje">
    </div>
    <div id="tabelaPrikaza" style="margin-left:10px;"></div>

    <div id="pretraga">
    </div>
    <div id="tabelaPretraga" style="margin-left:200px;"></div>

    <div id="block">
    </div>



    <!-- First Container -->
    <div id="pocetna1" class="container-fluid bg-1 text-center">
        <h2 class="margin" style="color:white;font-weight:bold;">DOBRO DOŠLI!</h2><hr />
        <img src="fin.jpg" class="img-responsive img-circle margin" style="display:inline" alt="Bird" width="250" height="250"><hr />
        <h3 id="lala" style="font-size:24px">Brojevi</h3>
        <h3 id="lala1" style="color:#ef5077;font-weight:bold">064 309 3116 &emsp;  <a href="#" id="broj"><i style="font-size:24px" class="fa">&#xf095;</i></a></h3>
        <h3 id="lala2" style="color:#ef5077;font-weight:bold">035 8470 027 &emsp; <a href="#" id="brojHome"><i style="font-size:24px" class="fa">&#xf095;</i></a></h3>
    </div>
    <!-- Second Container -->


    <div id="profil" style="width:800px; margin:0 auto;">
    </div>




    <div id="korisnik" style="margin-left:5px;">
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje </h3>
        <hr />
        <div id="tabelaVoznji">
        </div>
        <hr />

        <div id="izmenaPojedinacneVoznjeDiv">
        </div>

    </div>

    <div id="dispecer" style="margin-left:5px;">
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Vase voznje</h3>
        <hr />
        <div id="tabelaVoznjiDispecera">
        </div>
        <hr />
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje u sistemu </h3>
        <hr />
        <div id="tabelaSvihVoznji">
        </div>
        <hr />
    </div>


    <div id="vozac" style="margin-left:5px;">
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Vase voznje</h3>
        <hr />
        <div id="tabelaVoznjiVozaca">
        </div>
        <hr />

        <div id="neuspesnaVoznjaKomentarDiv">
        </div>



    </div>


    <div id="dodavanjeKorisnikaDiv" style="width:800px; margin:0 auto;">
    </div>

    <div id="dugmeDodajVozaca" style="width:800px; margin:0 auto;">
        <br />
        <button class="dugmeSrc" id="subBut">Dodaj vozaca</button>
    </div>

    <div id="formiranjeVoznjeDispecer" style="width:800px; margin:0 auto;">

    </div>

    <div id="map1">
        <br /><h3 style="margin-left:800px ">Odaberi lokaciju:</h3>
        <div id="map" class="map" style="width:500px;height:500px;margin-left:800px "></div>
    </div>

    <div id="voznjeNaCekanjuVozac" style="margin-left:5px;" >
        <h3 style="text-align:center;color:#1abc9c;font-weight:bold;">Sve voznje koje su na cekanju </h3>
        <hr />
        <div id="tabelaVoznjiNaCekanju">
        </div>
        <hr />
    </div>


    <div id="obradaVoznjeDispecer" style="width:800px; margin:0 auto;">

    </div>

    <div id="odabirVozaca" style="width:800px; margin:0 auto;">

    </div>



    <div id="dugmeIzmeni" style="width:800px; margin:0 auto;">
        <br />
        <button class="dugmeSrc" id="izmeni">Promeni informacije</button><br />
    </div>







    <div id="promeniLokacijuDiv" style="width:800px; margin:0 auto;">
        <div id="staraLokacija" style="margin-left:5px;"></div>


        <div id="tabelaIzmeniLokaciju"></div>
        <div id="dugmePromeniLokacijuDiv" style="width:800px; margin:0 auto;">
            <br />  <button class="dugmeSrc" id="promeniLokacijuBut">Promeni</button>
        </div>
        <div id="stariAuto" style="margin-left:5px;"></div>
        <div id="tabelaIzmeniAuto"></div>
    </div>





    <div id="naruciVoznjuDiv" style="width:800px; margin:0 auto;">
    </div>

    <div id="dugmeNaruciVoznjuDiv" style="width:800px; margin:0 auto;">
        <br /> <button class="dugmeSrc" id="naruciVoznjuBut">Naruci</button>
    </div>




    <div id="pocetna" class="container-fluid bg-2 text-center">
        <h3 class="margin">O kompaniji</h3>
        <p>
            Kompanija "Flamingo TAXI" osnovana je 2018.godine. Trudimo se da našim mušterijama pružimo što bržu i pouzdaniju uslugu. Na našem sajtu možete da naručite vožnju i Vaš vozač je tu za tren! Takođe, imate uvid u svim Vašim vožnjama.
            Možete ostaviti i komentar ukoliko imate neku zamerku ili pohvalu. Možete pretraživati, filtrirati vožnje kao i mnoge druge stvari..

        </p>
        <a href="#" class="btn btn-default btn-lg">
            <span class="glyphicon glyphicon-search"></span> Pretrazi sajt
        </a>
    </div>

    <br /> <footer class="container-fluid bg-4 text-center">
        <p>All rights reserved-Maja Djordjevic</p>
    </footer>


    <script>
        function myMap() {
            var mapCanvas = document.getElementById("map");
            var myCenter = new google.maps.LatLng(45.242630873254775, 19.842914435055945);
            var mapOptions = { center: myCenter, zoom: 15 };
            var map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(map, event.latLng);
            });
        }

        let fulAdresa = '';

        function placeMarker(map, location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });

            var fullAdresa = displayLocation(location.lat(), location.lng());

            var delovi = fullAdresa.split(",");
            var ulicaIbroj = delovi[0];
            var grad = delovi[1];//sa zipom
            var drzava = delovi[2];
            fulAdresa = location.lat() + "," + location.lng() + "," + ulicaIbroj + "," + grad + "," + drzava;

            var infowindow = new google.maps.InfoWindow({
                content: 'Latitude: ' + location.lat() + '<br>Longitude: ' + location.lng() + '<br>Ulica i broj: ' + ulicaIbroj + '<br>Grad: ' + grad + '<br>Drzava: ' + drzava + '<br>=' + displayLocation(location.lat(), location.lng())

            });
            infowindow.open(map, marker);
        }


        function displayLocation(latitude, longitude) {
            var request = new XMLHttpRequest();

            var method = 'GET';
            var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='
                + latitude + ',' + longitude + '&sensor=true';
            var async = false;
            var address;
            request.open(method, url, async);
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    var data = JSON.parse(request.responseText);
                    address = data.results[0];
                    var value = address.formatted_address.split(",");
                    count = value.length;
                    country = value[count - 1];
                    state = value[count - 2];
                    city = value[count - 3];
                }
            };
            request.send();
            return address.formatted_address;
        };

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrjeABCsOwW1rhi7eW6_b_fWF8OK2HeiA&callback=myMap"></script>

</body>
</html>
